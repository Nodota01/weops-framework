(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{o6D9:function(e,t,n){"use strict";n.r(t);var i,a=n("wA+L"),r=n("G0B5"),o=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=function(e,t,n,i){var a,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(r<3?a(o):r>3?a(t,n,o):a(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o},c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.visible=!1,t.loading=!1,t.roleInfo="",t.type="",t.formData={role_name:"",describe:"",id:""},t.rules={role_name:[{required:!0,message:"必填项",trigger:"blur"}]},t}return o(t,e),Object.defineProperty(t.prototype,"title",{get:function(){return"add"===this.type?"新增角色":"edit"===this.type?"编辑角色":"拷贝角色"},enumerable:!1,configurable:!0}),t.prototype.show=function(e,t){this.visible=!0,this.type=e,this.formData.role_name="",this.formData.describe="",["edit","copy"].includes(this.type)&&(this.roleInfo=t,this.formData.role_name=t.name,this.formData.describe=t.description,"edit"===this.type&&(this.formData.id=t.id))},t.prototype.close=function(){this.visible=!1},t.prototype.confirm=function(){var e=this;this.$refs.roleValidateForm.validate().then((function(t){var n="",i={};["add","copy"].includes(e.type)?(n="createRole",i.role_name=e.formData.role_name,i.description=e.formData.describe):(n="editRole",i={id:e.formData.id,description:e.formData.describe}),e.loading=!0,e.$api.RoleManageMain[n](i).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("".concat(e.title,"成功!")),e.$emit("refreshList"),e.close()})).finally((function(){e.loading=!1}))}))},t.prototype.closeDialog=function(){this.$refs.roleValidateForm.clearError()},t=s([r.a],t)}(r.d),l=c,u=n("KHd+"),d=Object(u.a)(l,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("bk-dialog",{attrs:{position:{top:150},theme:"primary",width:"600","mask-close":!1,"header-position":"left",title:e.title},on:{"after-leave":e.closeDialog},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"content-box"},[t("bk-form",{ref:"roleValidateForm",attrs:{"label-width":90,model:e.formData,rules:e.rules}},[t("bk-form-item",{attrs:{label:"角色名称",required:!0,property:"role_name"}},[t("bk-input",{attrs:{placeholder:"请输入角色名称",disabled:"edit"===e.type},model:{value:e.formData.role_name,callback:function(t){e.$set(e.formData,"role_name",t)},expression:"formData.role_name"}})],1),e._v(" "),t("bk-form-item",{attrs:{label:"角色描述"}},[t("bk-input",{attrs:{placeholder:"请输入角色描述",type:"textarea"},model:{value:e.formData.describe,callback:function(t){e.$set(e.formData,"describe",t)},expression:"formData.describe"}})],1)],1)],1),e._v(" "),t("template",{slot:"footer"},[t("bk-button",{staticClass:"mr10",attrs:{disabled:e.loading,theme:"primary",title:"确认"},on:{click:e.confirm}},[e._v("\n            确认\n        ")]),e._v(" "),t("bk-button",{attrs:{theme:"default",type:"submit",title:"取消"},on:{click:e.close}},[e._v("\n            取消\n        ")])],1)],2)}),[],!1,null,null,null).exports,h=n("6LyQ"),p=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),f=function(e,t,n,i){var a,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(r<3?a(o):r>3?a(t,n,o):a(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o},m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.menuList=[],t.menuLoading=!1,t.checkAuthMenusIds=[],t.operateAuthMenusIds=[],t.permissions={},t.checkMap={},t}return p(t,e),t.prototype.mounted=function(){this.menuList=JSON.parse(JSON.stringify(this.$store.state.permission.menuList));Object(h.e)(this.menuList,["ServiceDeskManage","AutoProcessManage","NoticeWays"]),this.handleMenus(this.menuList),this.getRoleMenus()},t.prototype.confirm=function(){var e=this;this.menuLoading=!0,this.$emit("getMenuLoading",this.menuLoading),this.$api.RoleManageMain.setRoleMenu({id:this.role.id,menu_ids:this.checkAuthMenusIds}).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("菜单权限设置成功！")})).finally((function(){e.menuLoading=!1,e.$emit("getMenuLoading",e.menuLoading)}))},t.prototype.getLatestMenu=function(){this.checkAuthMenusIds=[],this.operateAuthMenusIds=[],this.getSelectMenusIds(this.menuList),this.$emit("getLatestMenu",{checkAuthIds:this.checkAuthMenusIds,operateAuthIds:this.operateAuthMenusIds}),this.$emit("getPermissions",this.permissions)},t.prototype.getSelectMenusIds=function(e){var t=this;e.forEach((function(e){e.children&&t.getSelectMenusIds(e.children);var n={menuId:e.id,operate_ids:[]};e.auth.forEach((function(i){"check"===i.type&&i.value&&t.checkAuthMenusIds.push(e.id),e.children||"operate"===i.type&&i.value&&n.operate_ids.push(i.key)})),n.operate_ids.length&&t.operateAuthMenusIds.push(n)}))},t.prototype.setExpandStatus=function(e){e.children&&this.$set(e,"isExpand",!e.isExpand)},t.prototype.getIndeterminateValue=function(e,t){if(e.children){var n=[];e.children.forEach((function(e){e.auth.forEach((function(e){e.type===t&&n.push(e)}))})),e.auth.forEach((function(e){e.type===t&&(e.value=n.every((function(e){return e.value})),e.isIndeterminate=!(n.every((function(e){return e.value}))||n.every((function(e){return!e.value})))||!!n.find((function(e){return e.isIndeterminate})))})),e.isChecked=e.auth.every((function(e){return e.value})),e.isIndeterminate=!(e.auth.every((function(e){return e.value}))||e.auth.every((function(e){return!e.value})))||!!e.auth.find((function(e){return e.isIndeterminate}))}},t.prototype.handleOperateChecked=function(e,t,n){var i=this;e.isChecked=e.auth.every((function(e){return e.value})),e.auth.forEach((function(e){e.type===t&&(e.isIndeterminate=!1)})),"operate"===t&&e.auth.find((function(e){return"operate"===e.type&&e.value}))&&!n&&e.auth.forEach((function(t){"check"===t.type&&(t.value=!0,i.setCheckedStatus(e,t.value,"check"),i.handleParentChecked(e,"check"));var n=e.auth.find((function(e){return"manageAllArticlesAuth"===e.key}));"manageMyArticlesAuth"===t.key&&n.value&&(t.value=!0,i.setCheckedStatus(e,t.value,"check"),i.handleParentChecked(e,"check"))})),"check"!==t||e.auth.find((function(e){return"check"===e.type})).value||n||e.auth.forEach((function(t){"operate"===t.type&&(t.value=!1,i.setCheckedStatus(e,t.value,"operate"),i.handleParentChecked(e,"operate"))})),e.children?this.setCheckedStatus(e,e.auth.find((function(e){return e.type===t})).value,t):e.isIndeterminate=!(e.auth.every((function(e){return e.value}))||e.auth.every((function(e){return!e.value}))),this.handleParentChecked(e,t)},t.prototype.handleParentChecked=function(e,t){if(e.parentId){var n=this.findItemById(e.parentId,this.menuList);t?this.getIndeterminateValue(n,t):this.handleAllCheckValue(n),n.parentId&&this.handleParentChecked(n,t)}},t.prototype.handleAllCheckValue=function(e){e.children&&(e.isChecked=e.children.every((function(e){return e.isChecked})),e.isIndeterminate=!!e.children.find((function(e){return e.isChecked}))||!!e.children.find((function(e){return e.isIndeterminate})),e.auth.forEach((function(t){var n=[];e.children.forEach((function(e){e.auth.forEach((function(e){e.type===t.type&&n.push(e)}))})),t.value=n.every((function(e){return e.value}));var i=n.every((function(e){return e.value}))||n.every((function(e){return!e.value}));t.isIndeterminate=!i||!!n.find((function(e){return e.isIndeterminate}))})))},t.prototype.handleMenuChecked=function(e){this.setCheckedStatus(e,e.isChecked,"all")},t.prototype.setCheckedStatus=function(e,t,n,i){var a=this;e.children&&e.children.forEach((function(e){"all"===n&&a.$set(e,"isChecked",t),a.setCheckedStatus(e,t,n)})),"all"===n?(e.auth.forEach((function(e){a.$set(e,"value",t)})),this.$set(e,"isIndeterminate",!1),this.handleParentChecked(e)):(e.auth.forEach((function(e){e.type===n&&(e.value=t)})),e.isChecked=e.auth.every((function(e){return e.value})),e.isIndeterminate=!(e.auth.every((function(e){return e.value}))||e.auth.every((function(e){return!e.value}))))},t.prototype.handleMenus=function(e,t){var n=this;e.forEach((function(e){t&&n.$set(e,"parentId",t),n.$set(e,"isChecked",!1),n.$set(e,"isIndeterminate",!1),null==e||e.auth.forEach((function(e){n.$set(e,"isIndeterminate",!1)})),e.children&&(n.$set(e,"isExpand",!1),n.handleMenus(e.children,e.id))}))},t.prototype.findItemById=function(e,t){var n=t.find((function(t){return t.id===e}));if(n)return n;for(var i=0;i<t.length;i++)if(t[i].children instanceof Array&&t[i].children.length>0&&(n=this.findItemById(e,t[i].children)))return n;return null},t.prototype.getRoleMenus=function(){var e=this;this.menuLoading=!0,this.$emit("getMenuLoading",this.menuLoading),this.$api.RoleManageMain.getRoleMenus({roleId:this.role.id}).then((function(t){if(t.result){e.permissions=t.data.permissions;var n=e.changeDataFormat(t.data.permissions),i=e.getAllowedIds(t.data.permissions);e.$emit("getRawIds",i);var a=function(t){n[t].forEach((function(n){var i=e.findItemById("operate_ids"===t?n.menuId:n,e.menuList);if(i)if("operate_ids"===t)n[t].forEach((function(t){var n=i.auth.find((function(e){return e.key===t}));n.value=!0,e.handleOperateChecked(i,n.type,!0)}));else{if(i.children&&i.children.length)return!1;var a=i.auth.find((function(t){return t.key===e.checkMap[n]}));a.value=!0,e.handleOperateChecked(i,a.type)}}))};for(var r in n)a(r)}})).finally((function(){e.menuLoading=!1,e.$emit("getMenuLoading",e.menuLoading)}))},t.prototype.changeDataFormat=function(e){var t=this,n=[],i=[];return Object.keys(e).forEach((function(a){e[a].forEach((function(e){var r=e.name,o=e.allow;if(r.endsWith("view")&&o&&(!n.includes(a)&&n.push(a),t.checkMap[a]=r),!r.endsWith("view")&&o){var s=i.find((function(e){return e.menuId===a}));s?s.operate_ids.push(e.name):i.push({menuId:a,operate_ids:[e.name]})}}))})),{menus_ids:n,operate_ids:i}},t.prototype.getAllowedIds=function(e){var t=[];for(var n in e)for(var i=0,a=e[n];i<a.length;i++){var r=a[i];r.allow&&t.push(r.id)}return t},f([Object(r.c)({type:Object,default:function(){return{}}})],t.prototype,"role",void 0),t=f([r.a],t)}(r.d),v=m,y=Object(u.a)(v,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.menuLoading,zIndex:10},expression:"{ isLoading: menuLoading, zIndex: 10 }"}],staticClass:"operation-permission"},[e._m(0),e._v(" "),t("div",{staticClass:"table-body"},e._l(e.menuList,(function(n){return t("div",{key:n.id,staticClass:"menu-list"},[t("div",{staticClass:"first-level-box",on:{click:function(t){return e.setExpandStatus(n)}}},[t("div",{staticClass:"menu-name"},[n.children?t("bk-icon",{staticClass:"expand-icon",attrs:{type:n.isExpand?"down-shape":"right-shape"}}):e._e(),e._v(" "),t("bk-checkbox",{class:["check-box",!n.children&&"check-box-left"],attrs:{indeterminate:n.isIndeterminate,"true-value":!0,"false-value":!1},on:{change:function(t){return e.handleMenuChecked(n)}},nativeOn:{click:function(e){return e.stopPropagation(),(()=>{}).apply(null,arguments)}},model:{value:n.isChecked,callback:function(t){e.$set(n,"isChecked",t)},expression:"item.isChecked"}}),e._v(" "),t("span",[e._v(e._s(n.name))])],1),e._v(" "),n.auth?t("div",{staticClass:"menu-operate"},e._l(n.auth,(function(i,a){return t("div",{key:a},[t("bk-checkbox",{staticClass:"check-box",attrs:{"true-value":!0,"false-value":!1,indeterminate:i.isIndeterminate},on:{change:function(t){return e.handleOperateChecked(n,i.type)}},nativeOn:{click:function(e){return e.stopPropagation(),(()=>{}).apply(null,arguments)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"authItem.value"}}),e._v(" "),t("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[e._v(e._s(i.label))])],1)})),0):e._e()]),e._v(" "),n.isExpand?t("div",e._l(n.children,(function(n){return t("div",{key:n.id},[t("div",{staticClass:"second-level-box",on:{click:function(t){return e.setExpandStatus(n)}}},[t("div",{staticClass:"menu-name",staticStyle:{"padding-left":"40px"}},[n.children?t("bk-icon",{staticClass:"expand-icon",attrs:{type:n.isExpand?"down-shape":"right-shape"}}):e._e(),e._v(" "),t("bk-checkbox",{class:["check-box",!n.children&&"check-box-left"],attrs:{indeterminate:n.isIndeterminate,"true-value":!0,"false-value":!1},on:{change:function(t){return e.handleMenuChecked(n)}},nativeOn:{click:function(e){return e.stopPropagation(),(()=>{}).apply(null,arguments)}},model:{value:n.isChecked,callback:function(t){e.$set(n,"isChecked",t)},expression:"tex.isChecked"}}),e._v(" "),t("span",[e._v(e._s(n.name))])],1),e._v(" "),n.auth?t("div",{staticClass:"menu-operate"},e._l(n.auth,(function(i,a){return t("div",{key:a},[t("bk-checkbox",{staticClass:"check-box",attrs:{"true-value":!0,"false-value":!1,indeterminate:i.isIndeterminate},on:{change:function(t){return e.handleOperateChecked(n,i.type)}},nativeOn:{click:function(e){return e.stopPropagation(),(()=>{}).apply(null,arguments)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"authTex.value"}}),e._v(" "),t("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[e._v(e._s(i.label))])],1)})),0):e._e()]),e._v(" "),n.isExpand?t("div",e._l(n.children,(function(n){return t("div",{key:n.id,staticClass:"third-level-box"},[t("div",{staticClass:"menu-name",staticStyle:{"padding-left":"90px"}},[t("bk-checkbox",{class:["check-box"],attrs:{"true-value":!0,"false-value":!1,indeterminate:n.isIndeterminate},on:{change:function(t){return e.handleMenuChecked(n)}},model:{value:n.isChecked,callback:function(t){e.$set(n,"isChecked",t)},expression:"nev.isChecked"}}),e._v(" "),t("span",[e._v(e._s(n.name))])],1),e._v(" "),n.auth?t("div",{staticClass:"menu-operate"},[e._l(n.auth,(function(i,a){return["SysRole"!==n.id||"admin"===e.role.name||"SysRole_users_manage"===i.key||"SysRole_view"===i.key?t("div",{key:a},[t("bk-checkbox",{staticClass:"check-box",attrs:{"true-value":!0,"false-value":!1},on:{change:function(t){return e.handleOperateChecked(n,i.type)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"authNev.value"}}),e._v(" "),t("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[e._v(e._s(i.label))])],1):e._e()]}))],2):e._e()])})),0):e._e()])})),0):e._e()])})),0)])}),[function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"table-header"},[t("div",{staticClass:"menu-box"},[e._v("菜单")]),e._v(" "),t("div",{staticClass:"operate-box"},[e._v("操作权限")])])}],!1,null,"6a617182",null),g=y.exports,b=n("8lkm"),k=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),_=function(e,t,n,i){var a,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(r<3?a(o):r>3?a(t,n,o):a(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o},w=function(e,t,n){if(n||2===arguments.length)for(var i,a=0,r=t.length;a<r;a++)!i&&a in t||(i||(i=Array.prototype.slice.call(t,0,a)),i[a]=t[a]);return e.concat(i||Array.prototype.slice.call(t))},x=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isShow=!1,t.panels=[{name:"operationPermission",label:"操作权限"}],t.active="operationPermission",t.role={},t.menuLoading=!1,t.appLoading=!1,t.latestMenu=[],t.latestOperate=[],t.latestApp=[],t.loading=!1,t.permissions={},t.rawIds=[],t.changePermissionIds=[],t}return k(t,e),Object.defineProperty(t.prototype,"disableBtn",{get:function(){return"operationPermission"===this.active?this.menuLoading:this.appLoading},enumerable:!1,configurable:!0}),t.prototype.getLatestMenu=function(e){this.latestMenu=e.checkAuthIds,this.latestOperate=e.operateAuthIds},t.prototype.getMenuLoading=function(e){this.menuLoading=e},t.prototype.getAppLoading=function(e,t){this.appLoading=e,"hide"===t&&(this.isShow=!1)},t.prototype.show=function(e){this.isShow=!0,this.role=e,this.active="operationPermission"},t.prototype.toTabMenu=function(e){this.active=e.name},t.prototype.getPermissions=function(e){this.permissions=e},t.prototype.getRawIds=function(e){this.rawIds=e},t.prototype.confirm=function(){var e=this;this.$refs.menuPermission.getLatestMenu();var t=[];this.latestMenu.forEach((function(n){var i=e.permissions[n];if(i)for(var a=0;a<i.length;a++)i[a].name.endsWith("view")&&t.push(i[a].id)})),this.latestOperate.forEach((function(n){n.operate_ids.forEach((function(i){var a=e.getIdByName(e.permissions,n.menuId,i);t.push(a)}))})),this.changePermissionIds=this.compareArrays(this.rawIds,t),this.loading=!0,this.$api.RoleManageMain.setRoleMenu({id:this.role.id,array:this.changePermissionIds}).then((function(t){var n=t.result,i=t.message;if(!n)return e.$error(i),!1;e.$success("权限设置成功!"),e.isShow=!1})).finally((function(){e.loading=!1}))},t.prototype.getIdByName=function(e,t,n){if(e.hasOwnProperty(t))for(var i=e[t],a=0;a<i.length;a++)if(i[a].name===n)return i[a].id;return null},t.prototype.compareArrays=function(e,t){var n=e.filter((function(e){return!t.includes(e)})),i=t.filter((function(t){return!e.includes(t)}));return w(w([],n,!0),i,!0)},t=_([Object(r.a)({name:"permission-settings",components:{OperationPermission:g,menuTab:b.a}})],t)}(r.d),C=x,I=Object(u.a)(C,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("bk-sideslider",{attrs:{"is-show":e.isShow,"quick-close":!0,title:"权限管理",width:850},on:{"update:isShow":function(t){e.isShow=t},"update:is-show":function(t){e.isShow=t}}},[t("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[t("menu-tab",{attrs:{panels:e.panels,"active-panel":e.active},on:{click:e.toTabMenu}}),e._v(" "),t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"main-box"},[t("operation-permission",{directives:[{name:"show",rawName:"v-show",value:"operationPermission"===e.active,expression:"active === 'operationPermission'"}],ref:"menuPermission",attrs:{role:e.role},on:{getMenuLoading:e.getMenuLoading,getLatestMenu:e.getLatestMenu,getPermissions:e.getPermissions,getRawIds:e.getRawIds}})],1),e._v(" "),t("div",{staticClass:"footer-box"},["instancePermission"!==e.active?t("bk-button",{attrs:{disabled:e.disableBtn||e.loading,theme:"primary",title:"确定"},on:{click:e.confirm}},[e._v("\n                确定\n            ")]):e._e()],1)],1)])}),[],!1,null,"0664ffc1",null).exports,L=n("7Jkb"),$=n("NjKV"),O=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),P=function(){return P=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},P.apply(this,arguments)},M=function(e,t,n,i){var a,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(r<3?a(o):r>3?a(t,n,o):a(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o},R=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((i=i.apply(e,t||[])).next())}))},S=function(e,t){var n,i,a,r,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(o=0)),o;)try{if(n=1,i&&(a=2&s[0]?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tableLoading=!1,t.dataList=[],t.allDataList=[],t.columns=[{label:"角色名称",key:"name",align:"left",minWidth:"100px"},{label:"角色描述",key:"description",align:"left",minWidth:"300px"},{label:"创建时间",key:"created",align:"left",minWidth:"120"},{label:"操作",key:"operation",align:"left",width:"230px",scopedSlots:"operation"}],t.pagination={current:1,count:1,limit:20},t.maxHeight="",t.search="",t}return O(t,e),t.prototype.created=function(){var e=this;this.getRoleList();this.maxHeight=window.innerHeight-276,window.onresize=function(){e.maxHeight=window.innerHeight-276}},t.prototype.handlerIconClick=function(){var e=this;this.pagination.current=1,this.dataList=this.allDataList.filter((function(t){return t.name.includes(e.search)})),this.pagination.count=this.dataList.length},t.prototype.personnelManage=function(e){return R(this,void 0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return this.$BtnPermission({id:this.$route.name,type:"SysRole_users_manage"})?[4,this.$api.RoleManageMain.getRoleAllUser({id:e.id})]:[2,!1];case 1:return(t=n.sent()).data=t.data.map((function(e){return{id:e.id,bk_username:e.username,chname:e.lastName}})),this.$refs.authWhiteList.showSlider({user:t.data},e),[2]}}))}))},t.prototype.setPermission=function(e){if(!this.$BtnPermission({id:this.$route.name,type:"SysRole_permissions"}))return!1;this.$refs.permissionSettings.show(e)},t.prototype.operateRole=function(e,t){if(!this.$BtnPermission({id:this.$route.name,type:"edit"===e?"SysRole_edit":"SysRole_create"}))return!1;this.$refs.operateRole.show(e,t)},t.prototype.refreshList=function(){this.getRoleList()},t.prototype.deleteRole=function(e){var t=this;if(!this.$BtnPermission({id:this.$route.name,type:"SysRole_delete"}))return!1;this.$bkInfo({title:"确认要删除该角色？",confirmLoading:!0,confirmFn:function(){return R(t,void 0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this.confirmDelete(e)];case 1:return t.sent(),[2]}}))}))}})},t.prototype.confirmDelete=function(e){return R(this,void 0,void 0,(function(){var t;return S(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.$api.RoleManageMain.deleteRole({id:e.id})];case 1:return(t=n.sent()).result?(this.$success("删除成功!"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.getRoleList()):this.$error(t.message),[2,!0];case 2:return n.sent(),[2,!1];case 3:return[2]}}))}))},t.prototype.getRoleList=function(){var e=this;this.tableLoading=!0,this.$api.RoleManageMain.getRoleList().then((function(t){if(!t.result)return!1;e.allDataList=t.data.map((function(e){var t;return P(P({},e),{created:null===(t=e.attributes.created)||void 0===t?void 0:t[0]})}));var n=e.pagination,i=n.current,a=n.limit;e.dataList=e.allDataList.slice((i-1)*a,i*a),e.pagination.count=t.data.length})).finally((function(){e.tableLoading=!1}))},t.prototype.handlePageChange=function(e){var t=this;this.pagination.current=e;var n=this.pagination.limit;this.dataList=this.allDataList.filter((function(e){return e.name.includes(t.search)})).slice((e-1)*n,e*n)},t.prototype.limitChange=function(e){var t=this;this.pagination.current=1,this.pagination.limit=e,this.dataList=this.allDataList.filter((function(e){return e.name.includes(t.search)})).slice(0,e)},t=M([Object(r.a)({name:"role-manage",components:{ComTable:a.a,OperateRole:d,PermissionSettings:I,AuthWhiteList:L.a,PageExplanation:$.a}})],t)}(r.d),j=E,A=Object(u.a)(j,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"role-manage"},[t("page-explanation",{attrs:{title:"角色管理",content:"您可以进行角色的新建和授权，权限的授权分为操作权限和实例权限，可从菜单操作和实例管理两个方面进行限制"}}),e._v(" "),t("div",{staticClass:"role-manage-wrapper"},[t("div",{staticClass:"operate-box"},[t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:e.$route.name,type:"SysRole_create"},expression:"{\n                    id: $route.name,\n                    type: 'SysRole_create'\n                }"}],staticClass:"mr10",attrs:{theme:"primary",title:"新增角色",icon:"plus"},on:{click:function(t){return e.operateRole("add")}}},[e._v("\n                新增角色\n            ")]),e._v(" "),t("bk-input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"请输入搜索关键字","right-icon":"bk-icon icon-search"},on:{"right-icon-click":e.handlerIconClick,enter:e.handlerIconClick,clear:e.handlerIconClick},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),t("div",{staticClass:"table-box"},[t("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"comTable",attrs:{data:e.dataList,columns:e.columns,pagination:e.pagination,"max-height":e.maxHeight},on:{"page-change":e.handlePageChange,"page-limit-change":e.limitChange},scopedSlots:e._u([{key:"built_in",fn:function({row:t}){return[e._v("\n                    "+e._s(t.built_in?"是":"否")+"\n                ")]}},{key:"operation",fn:function({row:n}){return[t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:e.$route.name,type:"SysRole_users_manage"},expression:"{\n                            id: $route.name,\n                            type: 'SysRole_users_manage'\n                        }"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.personnelManage(n)}}},[e._v("\n                        人员管理\n                    ")]),e._v(" "),t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:e.$route.name,type:"SysRole_permissions"},expression:"{\n                            id: $route.name,\n                            type: 'SysRole_permissions'\n                        }"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:"admin"===n.name},on:{click:function(t){return e.setPermission(n)}}},[e._v("\n                        设置权限\n                    ")]),e._v(" "),t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:e.$route.name,type:"SysRole_edit"},expression:"{\n                            id: $route.name,\n                            type: 'SysRole_edit'\n                        }"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:"normal"===n.name||"admin"===n.name},on:{click:function(t){return e.operateRole("edit",n)}}},[e._v("\n                        编辑\n                    ")]),e._v(" "),t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:e.$route.name,type:"SysRole_delete"},expression:"{\n                            id: $route.name,\n                            type: 'SysRole_delete'\n                        }"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:"normal"===n.name||"admin"===n.name},on:{click:function(t){return e.deleteRole(n)}}},[e._v("\n                        删除\n                    ")])]}}])})],1),e._v(" "),t("operate-role",{ref:"operateRole",on:{refreshList:e.refreshList}}),e._v(" "),t("permission-settings",{ref:"permissionSettings"}),e._v(" "),t("auth-white-list",{ref:"authWhiteList",attrs:{"only-choose-user":!0,title:"人员管理"},on:{confirm:function(t){return e.getRoleList()}}})],1)],1)}),[],!1,null,"fdc6a1da",null);t.default=A.exports}}]);