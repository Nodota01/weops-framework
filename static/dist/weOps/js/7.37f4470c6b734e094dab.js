(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{ZJ0C:function(e,t,r){"use strict";r.r(t);var n,a=r("wA+L"),o=r("G0B5"),i=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=function(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i},l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.resetVisible=!1,t.password="",t.resetUser="",t.resetLoading=!1,t.formData={password:"",confirmPassword:""},t.rules={password:[{required:!0,message:"必填项",trigger:"blur"}],confirmPassword:[{required:!0,message:"必填项",trigger:"blur"},{validator:function(e){return e===t.formData.password},message:"两次输入密码不一致",trigger:"blur"}]},t}return i(t,e),t.prototype.show=function(e){this.resetVisible=!0,this.resetUser=e},t.prototype.close=function(){this.resetVisible=!1},t.prototype.closeResetDialog=function(){this.formData.password="",this.formData.confirmPassword="",this.$refs.validatePsdForm.clearError()},t.prototype.confirmReset=function(){var e=this;this.$refs.validatePsdForm.validate().then((function(t){e.resetLoading=!0,e.$api.UserManageMain.resetPassword({password:e.formData.password,id:e.resetUser.id}).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("重置密码成功!")})).finally((function(){e.resetLoading=!1,e.close()}))}))},t=s([Object(o.a)({name:"reset-password"})],t)}(o.f),c=l,u=r("KHd+"),p=Object(u.a)(c,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("bk-dialog",{attrs:{theme:"primary","mask-close":!1,"header-position":"left",title:"重置密码"},on:{"after-leave":e.closeResetDialog},model:{value:e.resetVisible,callback:function(t){e.resetVisible=t},expression:"resetVisible"}},[t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.resetLoading,zIndex:10},expression:"{ isLoading: resetLoading, zIndex: 10 }"}]},[t("bk-form",{ref:"validatePsdForm",attrs:{"label-width":80,model:e.formData,rules:e.rules}},[t("bk-form-item",{attrs:{required:!0,label:"重置密码",property:"password","error-display-type":"normal"}},[t("bk-input",{attrs:{clearable:!0,type:"password",placeholder:"请输入重置密码"},model:{value:e.formData.password,callback:function(t){e.$set(e.formData,"password",t)},expression:"formData.password"}})],1),e._v(" "),t("bk-form-item",{attrs:{required:!0,label:"确认密码",property:"confirmPassword","error-display-type":"normal"}},[t("bk-input",{attrs:{clearable:!0,type:"password",placeholder:"请输入重置密码"},model:{value:e.formData.confirmPassword,callback:function(t){e.$set(e.formData,"confirmPassword",t)},expression:"formData.confirmPassword"}})],1)],1)],1),e._v(" "),t("template",{slot:"footer"},[t("bk-button",{staticClass:"mr10",attrs:{disabled:e.resetLoading,theme:"primary",title:"确认"},on:{click:e.confirmReset}},[e._v("\n            确认\n        ")]),e._v(" "),t("bk-button",{attrs:{theme:"default",type:"submit",title:"取消"},on:{click:e.close}},[e._v("\n            取消\n        ")])],1)],2)}),[],!1,null,null,null).exports,d=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),f=function(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i},h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.visible=!1,t.loading=!1,t.userInfo={},t.type="",t.formData={username:"",lastName:"",email:"",password:"",confirmPassword:""},t.rules={username:[{required:!0,message:"必填项",trigger:"blur"}],lastName:[{required:!0,regex:/^$|^[\u4e00-\u9fa5]+$/,message:"必须是中文",trigger:"blur"}],password:[{required:!0,message:"必填项",trigger:"blur"}],confirmPassword:[{required:!0,message:"必填项",trigger:"blur"},{validator:function(e){return e===t.formData.password},message:"两次输入密码不一致",trigger:"blur"}]},t}return d(t,e),t.prototype.show=function(e,t){this.visible=!0,this.type=e,"edit"===this.type&&(this.userInfo=t,this.formData.username=t.username,this.formData.lastName=t.lastName,this.formData.email=t.email)},t.prototype.close=function(){this.visible=!1},t.prototype.confirm=function(){var e=this;this.$refs.validateForm.validate().then((function(t){var r="createUser",n={username:e.formData.username,lastName:e.formData.lastName,email:e.formData.email,password:e.formData.password};e.formData.email&&(n.email=e.formData.email),"add"!==e.type&&(r="editUser",n={id:e.userInfo.id,lastName:e.formData.lastName,email:e.formData.email}),e.loading=!0,e.$api.UserManageMain[r](n).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("".concat("add"===e.type?"新增":"编辑","用户成功!")),e.$emit("refreshList"),e.close()})).finally((function(){e.loading=!1}))}))},t.prototype.closeDialog=function(){Object.assign(this.$data,this.$options.data.call(this)),this.$refs.validateForm.clearError()},t=f([Object(o.a)({name:"operate-user"})],t)}(o.f),m=h,y=Object(u.a)(m,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("bk-dialog",{attrs:{position:{top:100},theme:"primary",width:"600","mask-close":!1,"header-position":"left",title:"add"===e.type?"新增用户":"编辑用户"},on:{"after-leave":e.closeDialog},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"content-box"},[t("bk-form",{ref:"validateForm",attrs:{"label-width":80,model:e.formData,rules:e.rules}},[t("bk-form-item",{attrs:{label:"用户名",required:!0,property:"username","error-display-type":"normal"}},[t("bk-input",{attrs:{disabled:"edit"===e.type,placeholder:"请输入用户名"},model:{value:e.formData.username,callback:function(t){e.$set(e.formData,"username",t)},expression:"formData.username"}})],1),e._v(" "),t("bk-form-item",{attrs:{label:"中文名",required:!0,property:"lastName","error-display-type":"normal"}},[t("bk-input",{attrs:{placeholder:"请输入中文名"},model:{value:e.formData.lastName,callback:function(t){e.$set(e.formData,"lastName",t)},expression:"formData.lastName"}})],1),e._v(" "),t("bk-form-item",{attrs:{label:"邮箱",property:"email","error-display-type":"normal"}},[t("bk-input",{attrs:{placeholder:"请输入邮箱"},model:{value:e.formData.email,callback:function(t){e.$set(e.formData,"email",t)},expression:"formData.email"}})],1),e._v(" "),"add"===e.type?t("bk-form-item",{attrs:{label:"密码",required:!0,property:"password","error-display-type":"normal"}},[t("bk-input",{attrs:{placeholder:"请输入密码",type:"password",clearable:!0},model:{value:e.formData.password,callback:function(t){e.$set(e.formData,"password",t)},expression:"formData.password"}})],1):e._e(),e._v(" "),"add"===e.type?t("bk-form-item",{attrs:{label:"确认密码",required:!0,property:"confirmPassword","error-display-type":"normal"}},[t("bk-input",{attrs:{placeholder:"请输入密码",type:"password",clearable:!0},model:{value:e.formData.confirmPassword,callback:function(t){e.$set(e.formData,"confirmPassword",t)},expression:"formData.confirmPassword"}})],1):e._e()],1)],1),e._v(" "),t("template",{slot:"footer"},[t("bk-button",{staticClass:"mr10",attrs:{disabled:e.loading,theme:"primary",title:"确认"},on:{click:e.confirm}},[e._v("\n            确认\n        ")]),e._v(" "),t("bk-button",{attrs:{theme:"default",type:"submit",title:"取消"},on:{click:e.close}},[e._v("\n            取消\n        ")])],1)],2)}),[],!1,null,null,null).exports,b=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),v=function(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i},g=function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}l((n=n.apply(e,t||[])).next())}))},_=function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},w=function(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loading=!1,t.search="",t.nodeData=[],t.visible=!1,t.userId="",t.rawSelected=[],t.deleteIds=[],t.addIds=[],t}return b(t,e),Object.defineProperty(t.prototype,"selectedNode",{get:function(){for(var e=[],t=0,r=this.nodeData;t<r.length;t++){var n=r[t];this.traverseTree(n,e)}return e},enumerable:!1,configurable:!0}),t.prototype.show=function(e,t){return g(this,void 0,void 0,(function(){return _(this,(function(r){switch(r.label){case 0:return this.rawSelected=e,this.userId=t,[4,this.getGroups()];case 1:return r.sent(),this.visible=!0,[2]}}))}))},t.prototype.handlerIconClick=function(){this.getGroups()},t.prototype.getGroups=function(){return g(this,void 0,void 0,(function(){var e,t,r,n,a=this;return _(this,(function(o){switch(o.label){case 0:return this.loading=!0,e={search:this.search},[4,this.$api.GroupManage.getGroups(e)];case 1:if(!(t=o.sent()).result)return[2,!1];for(r=function(e){t.data.forEach((function(t){a.handleData(t,a.rawSelected[e].id)}))},n=0;n<this.rawSelected.length;n++)r(n);return this.nodeData=t.data,this.loading=!1,[2]}}))}))},t.prototype.handleData=function(e,t){if(e.id===t)e.checked=!0;else if(e.subGroups&&e.subGroups.length>0)for(var r=0,n=e.subGroups;r<n.length;r++){var a=n[r];this.handleData(a,t)}},t.prototype.traverseTree=function(e,t){var r=t.findIndex((function(t){return t.id===e.id}));if(e.checked&&r<0?t.push(e):!e.checked&&r>=0&&t.splice(r,1),e.subGroups&&e.subGroups.length>0)for(var n=0,a=e.subGroups;n<a.length;n++){var o=a[n];this.traverseTree(o,t)}},t.prototype.handleClear=function(){for(var e=0,t=this.nodeData;e<t.length;e++){var r=t[e];this.checkedToFalse(r)}},t.prototype.checkedToFalse=function(e){if(e.checked&&(e.checked=!1),e.subGroups&&e.subGroups.length>0)for(var t=0,r=e.subGroups;t<r.length;t++){var n=r[t];this.checkedToFalse(n)}},t.prototype.handleDelete=function(e){for(var t=0,r=this.nodeData;t<r.length;t++){var n=r[t];this.deleteNode(n,e)}},t.prototype.deleteNode=function(e,t){if(e.id===t)e.checked=!1;else if(e.subGroups&&e.subGroups.length>0)for(var r=0,n=e.subGroups;r<n.length;r++){var a=n[r];this.deleteNode(a,t)}},t.prototype.handleConfirm=function(){this.findAddAndDel(this.rawSelected,this.selectedNode),this.setGroups()},t.prototype.findAddAndDel=function(e,t){for(var r=[],n=e.map((function(e){return e.id})),a=t.map((function(e){return e.id})),o=0;o<n.length;o++)a.includes(n[o])||r.push(n[o]);var i=[];for(o=0;o<a.length;o++)n.includes(a[o])||i.push(a[o]);this.deleteIds=r,this.addIds=i},t.prototype.setGroups=function(){return g(this,void 0,void 0,(function(){var e,t;return _(this,(function(r){switch(r.label){case 0:e=[],t=[],this.deleteIds.length>0&&e.push(this.$api.UserManageMain.delUserGroups({id:this.userId,deleteIds:this.deleteIds})),this.addIds.length>0&&t.push(this.$api.UserManageMain.addUserGroups({id:this.userId,addIds:this.addIds})),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Promise.all(w(w([],e,!0),t,!0))];case 2:return r.sent().every((function(e){return e.result}))&&(this.$success("设置组织成功"),this.handleClose(),this.$emit("confirm")),[3,4];case 3:return r.sent(),this.$warn("设置失败"),[3,4];case 4:return[2]}}))}))},t.prototype.handleClose=function(){this.visible=!1},v([Object(o.e)({type:String,default:function(){return"设置所在组织"}})],t.prototype,"title",void 0),t=v([Object(o.a)({name:"group-setting",components:{}})],t)}(o.f),x=k,D=Object(u.a)(x,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("bk-sideslider",{attrs:{"is-show":e.visible,"quick-close":!0,"before-close":e.handleClose,width:700,"ext-cls":"common-dialog-wrapper"},on:{"update:isShow":function(t){e.visible=t},"update:is-show":function(t){e.visible=t}}},[t("div",{attrs:{slot:"header"},slot:"header"},[e._v(e._s(e.title))]),e._v(" "),t("div",{staticClass:"transfer-box common-dialog-wrapper-main",attrs:{slot:"content"},slot:"content"},[t("div",{staticClass:"source-list"},[t("div",{staticClass:"header"},[e._v("待选择列表")]),e._v(" "),t("div",{staticClass:"content-box"},[t("div",{staticClass:"search"},[t("bk-input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"请输入搜索关键字","right-icon":"bk-icon icon-search"},on:{"right-icon-click":e.handlerIconClick,enter:e.handlerIconClick,clear:e.handlerIconClick},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"organization-box"},[e.nodeData.length?t("bk-big-tree",{ref:"tree",attrs:{"enable-title-tip":"","default-expand-all":!0,options:{childrenKey:"subGroups"},data:e.nodeData},scopedSlots:e._u([{key:"default",fn:function({data:r}){return t("div",{},[t("div",{staticClass:"node-box"},[t("div",{staticClass:"name"},[e._v(e._s(r.name))]),e._v(" "),t("bk-checkbox",{nativeOn:{click:function(e){return e.stopPropagation(),(()=>{}).apply(null,arguments)}},model:{value:r.checked,callback:function(t){e.$set(r,"checked",t)},expression:"data.checked"}})],1)])}}],null,!1,3715646647)}):t("bk-exception",{class:{"exception-gray":!1},attrs:{type:"empty",scene:"part"}})],1)])]),e._v(" "),t("div",{staticClass:"selection-container"},[t("p",[e._v("已选择（共"),t("span",[e._v(e._s(e.selectedNode.length))]),e._v("条）"),t("span",{staticClass:"clear",on:{click:e.handleClear}},[e._v("清空")])]),e._v(" "),t("ul",e._l(e.selectedNode,(function(r){return t("li",{key:r.id},[e._v("\n                    "+e._s(r.name)+"\n                    "),t("span",[e._v("组织")]),e._v(" "),t("bk-icon",{attrs:{type:"close"},on:{click:function(t){return e.handleDelete(r.id)}}})],1)})),0)])]),e._v(" "),t("template",{slot:"footer"},[t("bk-button",{staticClass:"mr10",attrs:{title:"确认",theme:"primary"},on:{click:e.handleConfirm}},[e._v("\n            确认\n        ")]),e._v(" "),t("bk-button",{attrs:{type:"submit",theme:"default",title:"取消"},on:{click:e.handleClose}},[e._v("\n            取消\n        ")])],1)],2)}),[],!1,null,"6f3278ca",null),L=D.exports,O=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),$=function(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i},C=function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}l((n=n.apply(e,t||[])).next())}))},S=function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},P=function(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},j=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tableLoading=!1,t.dataList=[],t.columns=[{label:"用户名",key:"username",align:"left",minWidth:"150px"},{label:"中文名",key:"lastName",align:"left",minWidth:"100px"},{label:"邮箱",key:"email",align:"left",minWidth:"150px"},{label:"用户角色",key:"roles",align:"left",minWidth:"220px",scopedSlots:"roles",filters:[],filterRemote:!0,filterMultiple:!0},{label:"组织",key:"groups",align:"left",minWidth:"100px",scopedSlots:"groups"},{label:"操作",key:"operation",align:"left",width:"240px",fixed:"right",scopedSlots:"operation"}],t.pagination={current:1,count:1,limit:20},t.roleList=[],t.maxHeight="",t.search="",t.roles=[],t}return O(t,e),t.prototype.created=function(){var e=this;this.getUserList(),this.getRoleList();this.maxHeight=window.innerHeight-328,window.onresize=function(){e.maxHeight=window.innerHeight-328}},t.prototype.getOrganizationOrSuperior=function(e,t){var r=t.listKey,n=t.fieldKey;return e[r].map((function(e){return e[n].slice(1)})).join(";")||"--"},t.prototype.sourceFilterMethod=function(e){this.roles=Object.values(e).flat(),this.handlerIconClick()},t.prototype.changeRole=function(e){var t=this;setTimeout((function(){for(var r=[],n=e.roleV1,a=e.allRoles,o=0;o<n.length;o++)a.includes(n[o])||r.push(n[o]);var i=r.map((function(r){return t.$api.RoleManageMain.deleteUserRole({id:r,userId:e.id})}));t.tableLoading=!0,Promise.all(i).then((function(e){e.every((function(e){return e.result}))&&t.getUserList()})).finally((function(){t.tableLoading=!1}))}),0)},t.prototype.refreshList=function(){this.getUserList()},t.prototype.handlerIconClick=function(){this.pagination.current=1,this.getUserList()},t.prototype.operateUser=function(e,t){if(!this.$BtnPermission({id:this.$route.name,type:"edit"===e?"SysUser_edit":"SysUser_create"}))return!1;this.$refs.operateUser.show(e,t)},t.prototype.resetPassword=function(e){if(!this.$BtnPermission({id:this.$route.name,type:"SysRole_edit"}))return!1;this.$refs.resetPassword.show(e)},t.prototype.deleteUser=function(e){var t=this;if(!this.$BtnPermission({id:this.$route.name,type:"SysUser_delete"}))return!1;this.$bkInfo({title:"确认要删除该用户？",confirmLoading:!0,confirmFn:function(){return C(t,void 0,void 0,(function(){return S(this,(function(t){switch(t.label){case 0:return[4,this.confirmDelete(e)];case 1:return t.sent(),[2]}}))}))}})},t.prototype.confirmDelete=function(e){return C(this,void 0,void 0,(function(){var t;return S(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.$api.UserManageMain.deleteUser({id:e.id,bk_user_id:e.bk_user_id})];case 1:return(t=r.sent()).result?(this.$success("删除成功"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.getUserList(),[3,3]):[2,this.$error(t.message)];case 2:return r.sent(),[2,!1];case 3:return[2]}}))}))},t.prototype.setUserRole=function(e){var t=e.allRoles.sort().toString()===e.roleV1.sort().toString();(e.allRoles.length!==e.roleV1.length||e.allRoles.length===e.roleV1.length&&!t)&&this.confirmSetRole(e)},t.prototype.confirmSetRole=function(e){var t=this,r=this.compareArrays(e.allRoles,e.roleV1),n=this.compareArrays(e.roleV1,e.allRoles),a=r.map((function(r){return t.$api.UserManageMain.setUserRoles({id:r,userId:e.id})})),o=n.map((function(r){return t.$api.RoleManageMain.deleteUserRole({id:r,userId:e.id})}));this.tableLoading=!0,Promise.all(P(P([],a,!0),o,!0)).then((function(e){e.every((function(e){return e.result}))&&(t.$success("设置成功！"),t.getUserList())})).finally((function(){t.tableLoading=!1}))},t.prototype.getUserList=function(){var e=this,t={roles:this.roles,page:this.pagination.current,per_page:this.pagination.limit,search:this.search};this.tableLoading=!0,this.$api.UserManageMain.getUserList(t).then((function(t){if(!t.result)return!1;e.dataList=t.data.users,e.dataList.forEach((function(t){var r=t.roles.map((function(e){return e.id})),n=t.group_roles.map((function(e){return e.id})),a=Array.from(new Set(P(P([],r,!0),n,!0).map(JSON.stringify))).map(JSON.parse);e.$set(t,"allRoles",a),e.$set(t,"roleV1",a)})),e.pagination.count=t.data.count})).finally((function(){e.tableLoading=!1}))},t.prototype.getRoleList=function(){var e=this;this.$api.RoleManageMain.getRoleList().then((function(t){if(!t.result)return!1;e.roleList=t.data.map((function(e){return{id:e.id,name:e.name}}));var r=e.columns.find((function(e){return"roles"===e.key}));r&&(r.filters=e.roleList.map((function(e){return{text:e.name,value:e.id}})))}))},t.prototype.handlePageChange=function(e){this.pagination.current=e,this.getUserList()},t.prototype.limitChange=function(e){this.pagination.current=1,this.pagination.limit=e,this.getUserList()},t.prototype.compareArrays=function(e,t){return e.filter((function(e){return!t.includes(e)}))},t.prototype.operateGroup=function(e){this.$refs.operateGroup.show(e.groups,e.id)},t.prototype.confirm=function(){this.getUserList(),this.getRoleList()},t=$([Object(o.a)({name:"user-manage",components:{comTable:a.a,resetPassword:p,operateUser:y,GroupSetting:L}})],t)}(o.f),U=j,R=Object(u.a)(U,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"user-manage"},[t("div",{staticClass:"operate-box"},[t("div",[t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:e.$route.name,type:"SysUser_create"},expression:"{\n                    id: $route.name,\n                    type: 'SysUser_create'\n                }"}],staticClass:"mr10",attrs:{disabled:e.tableLoading,theme:"primary",title:"新增用户",icon:"plus"},on:{click:function(t){return e.operateUser("add")}}},[e._v("\n                新增用户\n            ")])],1),e._v(" "),t("bk-input",{staticStyle:{width:"300px"},attrs:{disabled:e.tableLoading,clearable:"",placeholder:"请输入搜索关键字","right-icon":"bk-icon icon-search"},on:{"right-icon-click":e.handlerIconClick,enter:e.handlerIconClick,clear:e.handlerIconClick},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),t("div",{staticClass:"table-box"},[t("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"comTable",attrs:{data:e.dataList,columns:e.columns,"max-height":e.maxHeight,pagination:e.pagination},on:{"page-change":e.handlePageChange,"page-limit-change":e.limitChange,"filter-change":e.sourceFilterMethod},scopedSlots:e._u([{key:"roles",fn:function({row:r}){return[t("bk-select",{attrs:{searchable:"",multiple:"","display-tag":"",clearable:!1,disabled:"admin"===r.bk_username,"search-with-pinyin":!0},on:{toggle:function(t){return e.setUserRole(r)},"tab-remove":function(t){return e.changeRole(r)},clear:function(t){return e.changeRole(r)}},model:{value:r.allRoles,callback:function(t){e.$set(r,"allRoles",t)},expression:"row.allRoles"}},e._l(e.roleList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)]}},{key:"groups",fn:function({row:r}){return[t("span",[e._v(e._s(e.getOrganizationOrSuperior(r,{listKey:"groups",fieldKey:"path"})))])]}},{key:"operation",fn:function({row:r}){return[t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:e.$route.name,type:"SysUser_edit"},expression:"{\n                        id: $route.name,\n                        type: 'SysUser_edit'\n                    }"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.operateGroup(r)}}},[e._v("\n                    设置组织\n                ")]),e._v(" "),t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:e.$route.name,type:"SysUser_edit"},expression:"{\n                        id: $route.name,\n                        type: 'SysUser_edit'\n                    }"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.operateUser("edit",r)}}},[e._v("\n                    编辑\n                ")]),e._v(" "),t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:e.$route.name,type:"SysUser_delete"},expression:"{\n                        id: $route.name,\n                        type: 'SysUser_delete'\n                    }"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.deleteUser(r)}}},[e._v("\n                    删除\n                ")]),e._v(" "),t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:{id:e.$route.name,type:"SysUser_edit"},expression:"{\n                        id: $route.name,\n                        type: 'SysUser_edit'\n                    }"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.resetPassword(r)}}},[e._v("\n                    重置密码\n                ")])]}}])})],1),e._v(" "),t("reset-password",{ref:"resetPassword"}),e._v(" "),t("operate-user",{ref:"operateUser",on:{refreshList:e.refreshList}}),e._v(" "),t("group-setting",{ref:"operateGroup",on:{confirm:e.confirm}})],1)}),[],!1,null,"597de078",null).exports,I=r("gjeX"),M=r.n(I),N=r("7Jkb"),G=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),A=function(){return A=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},A.apply(this,arguments)},T=function(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i},F=function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}l((n=n.apply(e,t||[])).next())}))},V=function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loading=!1,t.formData={two_factor_enable:!0,auth_type:["mail"],auth_white_list:{user:[],role:[]},default_domain:""},t.typeList=[{name:"邮件",key:"mail"},{name:"短信",key:"msg"}],t.code="",t.allSelected=[],t.disabled=!0,t.isConfirm=!0,t.validateCode="",t.count=60,t.disabledValidate=!1,t.domainList=[],t.rules={default_domain:[{required:!0,message:"默认登陆域不能为空",trigger:"blur"}]},t.showDomainLoading=!1,t.showFactorLoading=!1,t.hasWhiteList=!1,t}return G(t,e),Object.defineProperty(t.prototype,"nameList",{get:function(){return this.allSelected.map((function(e){return"role"===e.type?e.role_name:e.bk_username})).join(",")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAdmin",{get:function(){return this.$store.getters.getUser.is_super},enumerable:!1,configurable:!0}),t.prototype.mounted=function(){return F(this,void 0,void 0,(function(){return V(this,(function(e){switch(e.label){case 0:return this.loading=!0,[4,this.getDomainList()];case 1:return e.sent(),[4,this.getLoginSet()];case 2:return e.sent(),this.disabled=!this.isAdmin,[2]}}))}))},t.prototype.saveDefaultDomain=function(){var e=this;this.$refs.validateForm.validate().then((function(t){e.setDomain()}))},t.prototype.setDomain=function(){return F(this,void 0,void 0,(function(){var e,t;return V(this,(function(r){switch(r.label){case 0:this.showDomainLoading=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),e={default_domain:this.formData.default_domain},[4,this.$api.UserManageMain.setDomain(e)];case 2:return(t=r.sent()).result?(this.$success("默认登陆域设置成功"),[3,4]):[2,this.$error(t.message)];case 3:return this.showDomainLoading=!1,[7];case 4:return[2]}}))}))},t.prototype.getLoginSet=function(){return F(this,void 0,void 0,(function(){var e;return V(this,(function(t){switch(t.label){case 0:this.loading=!0,t.label=1;case 1:return t.trys.push([1,,3,4]),[4,this.$api.UserManageMain.getLoginSet()];case 2:return(e=t.sent()).result?(this.formData=e.data,this.setWhiteStatus(),this.handleAllSelected(this.formData.auth_white_list),[3,4]):[2,this.$error(e.message)];case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},t.prototype.getDomainList=function(){return F(this,void 0,void 0,(function(){var e;return V(this,(function(t){switch(t.label){case 0:return[4,this.$api.UserManageMain.getDomainList()];case 1:return(e=t.sent()).result?(this.domainList=e.data,[2]):[2,this.$error(e.message)]}}))}))},t.prototype.handleGatherCode=function(){return F(this,void 0,void 0,(function(){var e,t,r=this;return V(this,(function(n){switch(n.label){case 0:return this.disabledValidate=!0,(e=function(){0===r.count?(r.disabledValidate=!1,r.count=60):(r.disabledValidate=!0,r.count--,setTimeout((function(){e()}),1e3))})(),[4,this.$api.UserManageMain.sendValidateCode()];case 1:return(t=n.sent()).result?(this.disabled=!1,this.validateCode=t.data.validate_code,[2]):[2,this.$error(t.message)]}}))}))},t.prototype.handleChoose=function(){this.$refs.authWhite.showSlider(this.formData.auth_white_list)},t.prototype.handleConfirm=function(e){this.formData.auth_white_list=this.$deepClone(e),this.setWhiteStatus(),this.handleAllSelected(e)},t.prototype.setWhiteStatus=function(){var e=this.formData.auth_white_list;this.hasWhiteList=!(!(null==e?void 0:e.user.length)&&!(null==e?void 0:e.role.length))},t.prototype.handleAllSelected=function(e){var t=this;void 0===e&&(e={}),this.allSelected=[],Object.keys(e).forEach((function(r){t.allSelected=t.allSelected.concat(e[r].map((function(e){return A(A({},e),{type:r})})))}))},t.prototype.handleSubmit=function(){return F(this,void 0,void 0,(function(){var e;return V(this,(function(t){switch(t.label){case 0:this.showFactorLoading=!0,t.label=1;case 1:return t.trys.push([1,,4,5]),this.isConfirm=M()(this.code)===this.validateCode,this.isConfirm||this.isAdmin?(this.formData.auth_type=Array.isArray(this.formData.auth_type)?this.formData.auth_type:[this.formData.auth_type],[4,this.$api.UserManageMain.updateLoginSet(this.formData)]):[3,3];case 2:if(!(e=t.sent()).result)return[2,this.$error(e.message)];this.$success("多因子认证设置成功"),t.label=3;case 3:return[3,5];case 4:return this.showFactorLoading=!1,[7];case 5:return[2]}}))}))},t=T([Object(o.a)({components:{AuthWhiteList:N.a}})],t)}(o.f),z=q,E=Object(u.a)(z,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"login-config"},[t("div",{staticClass:"multiple-factor-wrapper mb20"},[t("bk-form",{ref:"validateForm",attrs:{"label-width":200,model:e.formData,rules:e.rules}},[t("bk-form-item",{attrs:{label:"默认登陆域：",property:"default_domain","error-display-type":"normal",required:""}},[t("bk-select",{staticStyle:{width:"350px"},model:{value:e.formData.default_domain,callback:function(t){e.$set(e.formData,"default_domain",t)},expression:"formData.default_domain"}},e._l(e.domainList,(function(e,r){return t("bk-option",{key:r,attrs:{id:e,name:e}})})),1)],1),e._v(" "),t("bk-form-item",[t("bk-button",{staticStyle:{"margin-right":"3px"},attrs:{title:"保存",theme:"primary",disabled:e.disabled,loading:e.showDomainLoading},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.saveDefaultDomain.apply(null,arguments)}}},[e._v("\n                    保存\n                ")])],1)],1)],1),e._v(" "),t("div",{staticClass:"multiple-factor-wrapper"},[t("bk-form",{attrs:{"label-width":200,model:e.formData}},[t("bk-form-item",{attrs:{label:"开启双因子认证：",property:"two_factor_enable"}},[t("bk-switcher",{attrs:{size:"small",theme:"primary"},model:{value:e.formData.two_factor_enable,callback:function(t){e.$set(e.formData,"two_factor_enable",t)},expression:"formData.two_factor_enable"}})],1),e._v(" "),t("bk-form-item",{attrs:{label:"认证方式：",property:"auth_type"}},[t("bk-select",{staticStyle:{width:"350px"},attrs:{clearable:!1,"ext-cls":"select-custom","ext-popover-cls":"select-popover-custom"},model:{value:e.formData.auth_type,callback:function(t){e.$set(e.formData,"auth_type",t)},expression:"formData.auth_type"}},e._l(e.typeList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{label:"白名单：",property:"auth_white_list"}},[t("div",{staticClass:"auth-white-list",on:{click:e.handleChoose}},[e.hasWhiteList?t("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],staticClass:"overflow"},[e._v(e._s(e.nameList))]):t("span",{staticClass:"placeholder"},[e._v("请选择白名单")])])]),e._v(" "),e.isAdmin?e._e():t("bk-form-item",{attrs:{label:"验证码：",property:"code"}},[t("div",{staticClass:"code-container"},[t("bk-input",{staticStyle:{width:"350px"},attrs:{placeholder:"请输入验证码"},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}}),e._v(" "),e.disabledValidate?t("span",{staticClass:"tip-txt tip-txt-disabled"},[e._v("\n                        重新发送"),t("span",[e._v(e._s(e.count))]),e._v("后\n                    ")]):t("span",{staticClass:"tip-txt",on:{click:e.handleGatherCode}},[e._v("\n                        获取验证码\n                    ")]),e._v(" "),e.isConfirm?e._e():t("div",{staticClass:"m0",staticStyle:{color:"#f00"}},[e._v("请输入正确的验证码")])],1)]),e._v(" "),t("bk-form-item",[t("bk-button",{staticStyle:{"margin-right":"3px"},attrs:{title:"保存",theme:"primary",disabled:e.disabled,loading:e.showFactorLoading},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[e._v("\n                    保存\n                ")])],1)],1),e._v(" "),t("auth-white-list",{ref:"authWhite",on:{confirm:e.handleConfirm}})],1)])}),[],!1,null,"392a56bc",null),W=E.exports,H=r("8lkm"),K=r("Z4DM"),J=r("NjKV"),B=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Z=function(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i},X=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.panels=[{name:"userManage",label:"用户列表",content:"展示所有自动/手动同步的用户信息，您可以进行用户信息的维护和角色的授予"},{name:"multipleFactor",label:"登录配置",content:"支持对系统登录的登录域和认证方式进行设置，根据设置对登录方式进行限制"}],t.active="userManage",t}return B(t,e),Object.defineProperty(t.prototype,"user",{get:function(){return this.$store.state.permission.user},enumerable:!1,configurable:!0}),t.prototype.created=function(){this.user.is_super||(this.panels=this.panels.filter((function(e){return"userCatalog"!==e.name})),this.active=this.panels[0].name)},t.prototype.getTitleOrContent=function(e){var t=this;return this.panels.find((function(e){return e.name===t.active}))[e]},t.prototype.toTabMenu=function(e){this.active=e.name},t=Z([Object(o.a)({name:"user-manage-index",components:{MenuTab:H.a,UserManage:R,HeaderSub:K.a,MultipleFactor:W,PageExplanation:J.a}})],t)}(o.f),Q=X,Y=Object(u.a)(Q,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("page-explanation",{attrs:{title:e.getTitleOrContent("label"),content:e.getTitleOrContent("content")}}),e._v(" "),t(e.active,{tag:"component",staticStyle:{height:"calc(100% - 140px)"}})],1)}),[],!1,null,"7a488e0f",null);t.default=Y.exports}}]);