(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{o6D9:function(e,t,n){"use strict";n.r(t);var i,a=n("wA+L"),o=n("G0B5"),r=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=function(){return s=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},s.apply(this,arguments)},c=function(e,t,n,i){var a,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,n,r):a(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.visible=!1,t.loading=!1,t.roleInfo="",t.type="",t.formData={role_name:"",describe:"",id:""},t.rules={role_name:[{required:!0,message:"必填项",trigger:"blur"}]},t}return r(t,e),Object.defineProperty(t.prototype,"title",{get:function(){return"add"===this.type?"新增角色":"edit"===this.type?"编辑角色":"拷贝角色"},enumerable:!1,configurable:!0}),t.prototype.show=function(e,t){this.visible=!0,this.type=e,this.formData.role_name="",this.formData.describe="",["edit","copy"].includes(this.type)&&(this.roleInfo=t,this.formData.role_name=t.role_name,this.formData.describe=t.describe,"edit"===this.type&&(this.formData.id=t.id))},t.prototype.close=function(){this.visible=!1},t.prototype.confirm=function(){var e=this;this.$refs.roleValidateForm.validate().then((function(t){var n="",i={};["add","copy"].includes(e.type)?(n="createRole",i.role_name=e.formData.role_name,i.describe=e.formData.describe):(n="editRole",i=s({},e.formData)),e.loading=!0,e.$api.RoleManageMain[n](i).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("".concat(e.title,"成功!")),e.$emit("refreshList"),e.close()})).finally((function(){e.loading=!1}))}))},t.prototype.closeDialog=function(){this.$refs.roleValidateForm.clearError()},t=c([o.a],t)}(o.d),u=l,p=n("KHd+"),d=Object(p.a)(u,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("bk-dialog",{attrs:{position:{top:150},theme:"primary",width:"600","mask-close":!1,"header-position":"left",title:e.title},on:{"after-leave":e.closeDialog},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"content-box"},[t("bk-form",{ref:"roleValidateForm",attrs:{"label-width":90,model:e.formData,rules:e.rules}},[t("bk-form-item",{attrs:{label:"角色名称",required:!0,property:"role_name"}},[t("bk-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.formData.role_name,callback:function(t){e.$set(e.formData,"role_name",t)},expression:"formData.role_name"}})],1),e._v(" "),t("bk-form-item",{attrs:{label:"角色描述"}},[t("bk-input",{attrs:{placeholder:"请输入角色描述",type:"textarea"},model:{value:e.formData.describe,callback:function(t){e.$set(e.formData,"describe",t)},expression:"formData.describe"}})],1)],1)],1),e._v(" "),t("template",{slot:"footer"},[t("bk-button",{staticClass:"mr10",attrs:{disabled:e.loading,theme:"primary",title:"确认"},on:{click:e.confirm}},[e._v("\n            确认\n        ")]),e._v(" "),t("bk-button",{attrs:{theme:"default",type:"submit",title:"取消"},on:{click:e.close}},[e._v("\n            取消\n        ")])],1)],2)}),[],!1,null,null,null).exports,h=n("7hWu"),f=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),m=function(e,t,n,i){var a,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,n,r):a(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rtxList=[],t.rtxValue=[],t.sourceLength=0,t.targetLength=0,t.selectApp=[],t.appLoading=!1,t}return f(t,e),t.prototype.getRoleApplications=function(){return this.$api.RoleManageMain.getRoleApplications({id:this.role.id})},t.prototype.confirm=function(){var e=this;this.appLoading=!0,this.$emit("getAppLoading",this.appLoading);var t={id:this.role.id,app_ids:this.selectApp.map((function(e){return e.bk_biz_id}))};this.$api.RoleManageMain.setAppPermissions(t).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("应用权限设置成功！")})).finally((function(){e.appLoading=!1,e.$emit("getAppLoading",e.appLoading)}))},t.prototype.change=function(e,t){this.sourceLength=e.length,this.targetLength=t.length,this.selectApp=t},t.prototype.addAll=function(){this.rtxValue=this.rtxList.map((function(e){return e.bk_biz_id}))},t.prototype.removeAll=function(){this.rtxValue=[]},t.prototype.getLatestApp=function(){this.$emit("getLatestApp",this.selectApp.map((function(e){return e.bk_biz_id})))},m([Object(o.c)({type:Object,default:function(){return{}}})],t.prototype,"role",void 0),t=m([Object(o.a)({name:"app-permission",components:{bkTransfer:h.bkTransfer}})],t)}(o.d),b=v,y=Object(p.a)(b,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.appLoading,zIndex:10},expression:"{ isLoading: appLoading, zIndex: 10 }"}],staticClass:"app-permission"},[t("div",{staticClass:"content-box"},[t("bk-transfer",{attrs:{"source-list":e.rtxList,"target-list":e.rtxValue,"display-key":"bk_biz_name","sort-key":"bk_biz_id","setting-key":"bk_biz_id",sortable:!0},on:{change:e.change}},[t("div",{staticClass:"left-header",attrs:{slot:"left-header"},slot:"left-header"},[t("label",[e._v(e._s("无权限应用("+e.sourceLength+")"))]),e._v(" "),t("div",{staticClass:"add-all"},[e.sourceLength?t("span",{on:{click:e.addAll}},[e._v("选择全部")]):t("span",{staticClass:"disabled"},[e._v("选择全部")])])]),e._v(" "),t("div",{staticClass:"right-header",attrs:{slot:"right-header"},slot:"right-header"},[t("label",[e._v(e._s("有权限应用("+e.targetLength+")"))]),e._v(" "),t("div",{staticClass:"remove-all"},[e.targetLength?t("span",{on:{click:e.removeAll}},[e._v("全部移除")]):t("span",{staticClass:"disabled"},[e._v("全部移除")])])]),e._v(" "),t("div",{attrs:{slot:"left-empty-content"},slot:"left-empty-content"},[t("div",{staticClass:"empty-content"},[e._v("\n                    数据为空\n                ")])]),e._v(" "),t("div",{attrs:{slot:"right-empty-content"},slot:"right-empty-content"},[t("div",{staticClass:"empty-content"},[e._v("\n                    未选择任何数据\n                ")])])])],1)])}),[],!1,null,"0233548a",null).exports,g=n("6LyQ"),_=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),k=function(e,t,n,i){var a,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,n,r):a(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.menuList=[],t.menuLoading=!1,t.checkAuthMenusIds=[],t.operateAuthMenusIds=[],t}return _(t,e),t.prototype.mounted=function(){this.menuList=JSON.parse(JSON.stringify(this.$store.state.permission.menuList));Object(g.e)(this.menuList,["ServiceDeskManage","AutoProcessManage","SysRole","SysUser","NoticeWays"]),this.handleMenus(this.menuList),this.getRoleMenus()},t.prototype.confirm=function(){var e=this;this.menuLoading=!0,this.$emit("getMenuLoading",this.menuLoading),this.$api.RoleManageMain.setRoleMenu({id:this.role.id,menu_ids:this.checkAuthMenusIds}).then((function(t){if(!t.result)return e.$error(t.message),!1;e.$success("菜单权限设置成功！")})).finally((function(){e.menuLoading=!1,e.$emit("getMenuLoading",e.menuLoading)}))},t.prototype.getLatestMenu=function(){this.checkAuthMenusIds=[],this.operateAuthMenusIds=[],this.getSelectMenusIds(this.menuList),this.$emit("getLatestMenu",{checkAuthIds:this.checkAuthMenusIds,operateAuthIds:this.operateAuthMenusIds})},t.prototype.getSelectMenusIds=function(e){var t=this;e.forEach((function(e){e.children&&t.getSelectMenusIds(e.children);var n={menuId:e.id,operate_ids:[]};e.auth.forEach((function(i){"check"===i.type&&i.value&&t.checkAuthMenusIds.push(e.id),e.children||"operate"===i.type&&i.value&&n.operate_ids.push(i.key)})),n.operate_ids.length&&t.operateAuthMenusIds.push(n)}))},t.prototype.setExpandStatus=function(e){e.children&&this.$set(e,"isExpand",!e.isExpand)},t.prototype.getIndeterminateValue=function(e,t){if(e.children){var n=[];e.children.forEach((function(e){e.auth.forEach((function(e){e.type===t&&n.push(e)}))})),e.auth.forEach((function(e){e.type===t&&(e.value=n.every((function(e){return e.value})),e.isIndeterminate=!(n.every((function(e){return e.value}))||n.every((function(e){return!e.value})))||!!n.find((function(e){return e.isIndeterminate})))})),e.isChecked=e.auth.every((function(e){return e.value})),e.isIndeterminate=!(e.auth.every((function(e){return e.value}))||e.auth.every((function(e){return!e.value})))||!!e.auth.find((function(e){return e.isIndeterminate}))}},t.prototype.handleOperateChecked=function(e,t,n){var i=this;e.isChecked=e.auth.every((function(e){return e.value})),e.auth.forEach((function(e){e.type===t&&(e.isIndeterminate=!1)})),"operate"===t&&e.auth.find((function(e){return"operate"===e.type&&e.value}))&&!n&&e.auth.forEach((function(t){"check"===t.type&&(t.value=!0,i.setCheckedStatus(e,t.value,"check"),i.handleParentChecked(e,"check"));var n=e.auth.find((function(e){return"manageAllArticlesAuth"===e.key}));"manageMyArticlesAuth"===t.key&&n.value&&(t.value=!0,i.setCheckedStatus(e,t.value,"check"),i.handleParentChecked(e,"check"))})),"check"!==t||e.auth.find((function(e){return"check"===e.type})).value||n||e.auth.forEach((function(t){"operate"===t.type&&(t.value=!1,i.setCheckedStatus(e,t.value,"operate"),i.handleParentChecked(e,"operate"))})),e.children?this.setCheckedStatus(e,e.auth.find((function(e){return e.type===t})).value,t):e.isIndeterminate=!(e.auth.every((function(e){return e.value}))||e.auth.every((function(e){return!e.value}))),this.handleParentChecked(e,t)},t.prototype.handleParentChecked=function(e,t){if(e.parentId){var n=this.findItemById(e.parentId,this.menuList);t?this.getIndeterminateValue(n,t):this.handleAllCheckValue(n),n.parentId&&this.handleParentChecked(n,t)}},t.prototype.handleAllCheckValue=function(e){e.children&&(e.isChecked=e.children.every((function(e){return e.isChecked})),e.isIndeterminate=!!e.children.find((function(e){return e.isChecked}))||!!e.children.find((function(e){return e.isIndeterminate})),e.auth.forEach((function(t){var n=[];e.children.forEach((function(e){e.auth.forEach((function(e){e.type===t.type&&n.push(e)}))})),t.value=n.every((function(e){return e.value}));var i=n.every((function(e){return e.value}))||n.every((function(e){return!e.value}));t.isIndeterminate=!i||!!n.find((function(e){return e.isIndeterminate}))})))},t.prototype.handleMenuChecked=function(e){this.setCheckedStatus(e,e.isChecked,"all")},t.prototype.setCheckedStatus=function(e,t,n,i){var a=this;e.children&&e.children.forEach((function(e){"all"===n&&a.$set(e,"isChecked",t),a.setCheckedStatus(e,t,n)})),"all"===n?(e.auth.forEach((function(e){a.$set(e,"value",t)})),this.$set(e,"isIndeterminate",!1),this.handleParentChecked(e)):(e.auth.forEach((function(e){e.type===n&&(e.value=t)})),e.isChecked=e.auth.every((function(e){return e.value})),e.isIndeterminate=!(e.auth.every((function(e){return e.value}))||e.auth.every((function(e){return!e.value}))))},t.prototype.handleMenus=function(e,t){var n=this;e.forEach((function(e){t&&n.$set(e,"parentId",t),n.$set(e,"isChecked",!1),n.$set(e,"isIndeterminate",!1),e.auth.forEach((function(e){n.$set(e,"isIndeterminate",!1)})),e.children&&(n.$set(e,"isExpand",!1),n.handleMenus(e.children,e.id))}))},t.prototype.findItemById=function(e,t){var n=t.find((function(t){return t.id===e}));if(n)return n;for(var i=0;i<t.length;i++)if(t[i].children instanceof Array&&t[i].children.length>0&&(n=this.findItemById(e,t[i].children)))return n;return null},t.prototype.getRoleMenus=function(){var e=this;this.menuLoading=!0,this.$emit("getMenuLoading",this.menuLoading),this.$api.RoleManageMain.getRoleMenus({id:this.role.id}).then((function(t){if(!t.result)return!1;var n=function(n){t.data[n].forEach((function(t){var i=e.findItemById("operate_ids"===n?t.menuId:t,e.menuList);if(i)if("operate_ids"===n)t[n].forEach((function(t){var n=i.auth.find((function(e){return e.key===t}));n.value=!0,e.handleOperateChecked(i,n.type,!0)}));else{if(i.children&&i.children.length)return!1;var a=i.auth.find((function(e){return"checkAuth"===e.key}));a.value=!0,e.handleOperateChecked(i,a.type)}}))};for(var i in t.data)n(i)})).finally((function(){e.menuLoading=!1,e.$emit("getMenuLoading",e.menuLoading)}))},k([Object(o.c)({type:Object,default:function(){return{}}})],t.prototype,"role",void 0),t=k([o.a],t)}(o.d),w=L,x=Object(p.a)(w,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.menuLoading,zIndex:10},expression:"{ isLoading: menuLoading, zIndex: 10 }"}],staticClass:"operation-permission"},[e._m(0),e._v(" "),t("div",{staticClass:"table-body"},e._l(e.menuList,(function(n){return t("div",{key:n.id,staticClass:"menu-list"},[t("div",{staticClass:"first-level-box",on:{click:function(t){return e.setExpandStatus(n)}}},[t("div",{staticClass:"menu-name"},[n.children?t("bk-icon",{staticClass:"expand-icon",attrs:{type:n.isExpand?"down-shape":"right-shape"}}):e._e(),e._v(" "),t("bk-checkbox",{class:["check-box",!n.children&&"check-box-left"],attrs:{indeterminate:n.isIndeterminate,"true-value":!0,"false-value":!1},on:{change:function(t){return e.handleMenuChecked(n)}},nativeOn:{click:function(e){return e.stopPropagation(),(()=>{}).apply(null,arguments)}},model:{value:n.isChecked,callback:function(t){e.$set(n,"isChecked",t)},expression:"item.isChecked"}}),e._v(" "),t("span",[e._v(e._s(n.name))])],1),e._v(" "),n.auth?t("div",{staticClass:"menu-operate"},e._l(n.auth,(function(i,a){return t("div",{key:a},[t("bk-checkbox",{staticClass:"check-box",attrs:{"true-value":!0,"false-value":!1,indeterminate:i.isIndeterminate},on:{change:function(t){return e.handleOperateChecked(n,i.type)}},nativeOn:{click:function(e){return e.stopPropagation(),(()=>{}).apply(null,arguments)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"authItem.value"}}),e._v(" "),t("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[e._v(e._s(i.label))])],1)})),0):e._e()]),e._v(" "),n.isExpand?t("div",e._l(n.children,(function(n){return t("div",{key:n.id},[t("div",{staticClass:"second-level-box",on:{click:function(t){return e.setExpandStatus(n)}}},[t("div",{staticClass:"menu-name",staticStyle:{"padding-left":"40px"}},[n.children?t("bk-icon",{staticClass:"expand-icon",attrs:{type:n.isExpand?"down-shape":"right-shape"}}):e._e(),e._v(" "),t("bk-checkbox",{class:["check-box",!n.children&&"check-box-left"],attrs:{indeterminate:n.isIndeterminate,"true-value":!0,"false-value":!1},on:{change:function(t){return e.handleMenuChecked(n)}},nativeOn:{click:function(e){return e.stopPropagation(),(()=>{}).apply(null,arguments)}},model:{value:n.isChecked,callback:function(t){e.$set(n,"isChecked",t)},expression:"tex.isChecked"}}),e._v(" "),t("span",[e._v(e._s(n.name))])],1),e._v(" "),n.auth?t("div",{staticClass:"menu-operate"},e._l(n.auth,(function(i,a){return t("div",{key:a},[t("bk-checkbox",{staticClass:"check-box",attrs:{"true-value":!0,"false-value":!1,indeterminate:i.isIndeterminate},on:{change:function(t){return e.handleOperateChecked(n,i.type)}},nativeOn:{click:function(e){return e.stopPropagation(),(()=>{}).apply(null,arguments)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"authTex.value"}}),e._v(" "),t("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[e._v(e._s(i.label))])],1)})),0):e._e()]),e._v(" "),n.isExpand?t("div",e._l(n.children,(function(n){return t("div",{key:n.id,staticClass:"third-level-box"},[t("div",{staticClass:"menu-name",staticStyle:{"padding-left":"90px"}},[t("bk-checkbox",{class:["check-box"],attrs:{"true-value":!0,"false-value":!1,indeterminate:n.isIndeterminate},on:{change:function(t){return e.handleMenuChecked(n)}},model:{value:n.isChecked,callback:function(t){e.$set(n,"isChecked",t)},expression:"nev.isChecked"}}),e._v(" "),t("span",[e._v(e._s(n.name))])],1),e._v(" "),n.auth?t("div",{staticClass:"menu-operate"},e._l(n.auth,(function(i,a){return t("div",{key:a},[t("bk-checkbox",{staticClass:"check-box",attrs:{"true-value":!0,"false-value":!1},on:{change:function(t){return e.handleOperateChecked(n,i.type)}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"authNev.value"}}),e._v(" "),t("span",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}]},[e._v(e._s(i.label))])],1)})),0):e._e()])})),0):e._e()])})),0):e._e()])})),0)])}),[function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"table-header"},[t("div",{staticClass:"menu-box"},[e._v("菜单")]),e._v(" "),t("div",{staticClass:"operate-box"},[e._v("操作权限")])])}],!1,null,"314b932d",null),C=x.exports,P=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),I=function(e,t,n,i){var a,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,n,r):a(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.visible=!1,t.tableData=[],t.tableLoading=!1,t.columns=[],t.pagination={current:1,count:100,limit:20,small:!0},t.selectList=[],t.searchValue="",t}return P(t,e),t.prototype.show=function(e){this.visible=!0,this.searchValue="",this.updateColumns(),this.getList(),this.selectList=e},t.prototype.confirm=function(){this.$emit("change-list",this.selectList)},t.prototype.updateColumns=function(){var e=this;this.$nextTick((function(){e.$refs.comTable.updateColumns(e.instanceColumns)}))},t.prototype.selectTableData=function(e,t){this.selectList.map((function(e){return e.id})).includes(t.id)?this.selectList.splice(this.selectList.findIndex((function(e){return e.id===t.id})),1):this.selectList.push(t)},t.prototype.selectAllTableData=function(e){var t=this;0===e.length?this.selectList=this.selectList.filter((function(e){return!t.tableData.some((function(t){return e.id===t.id}))})):e.forEach((function(e){t.selectList.map((function(e){return e.id})).includes(e.id)||t.selectList.push(e)}))},t.prototype.getList=function(){var e=this;this.tableLoading=!0,this.$api.RoleManageMain.getInstances({page:this.pagination.current,page_size:this.pagination.limit,search:this.searchValue,instance_type:this.instanceType,bk_obj_id:this.modelId}).then((function(t){var n=t.result,i=t.data;if(!n)return!1;e.tableData=i.items,e.pagination.count=i.count,e.$nextTick((function(){e.selectList.length>0&&e.tableData.forEach((function(t){e.selectList.find((function(e){return e.id===t.id}))&&e.$refs.comTable.toggleRowSelection(t,!0)}))}))})).finally((function(){e.tableLoading=!1}))},t.prototype.handlePageChange=function(e){this.pagination.current=e,this.getList()},t.prototype.limitChange=function(e){this.pagination.current=1,this.pagination.limit=e,this.getList()},t.prototype.clearSelect=function(){this.selectList=[],this.$refs.comTable.clearSelection()},t.prototype.removeSelect=function(e,t){var n=this;this.selectList.splice(t,1),this.$nextTick((function(){n.tableData.forEach((function(t){t.id===e.id&&n.$refs.comTable.toggleRowSelection(t,!1)}))}))},I([Object(o.c)({type:Array,default:function(){return[]}})],t.prototype,"instanceColumns",void 0),I([Object(o.c)({type:String,default:function(){return""}})],t.prototype,"instanceType",void 0),I([Object(o.c)({type:String,default:function(){return""}})],t.prototype,"modelId",void 0),I([Object(o.c)({type:String,default:function(){return""}})],t.prototype,"instanceShowField",void 0),t=I([Object(o.a)({components:{ComTable:a.a}})],t)}(o.d),D=O,j=Object(p.a)(D,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("bk-dialog",{attrs:{position:{top:50},width:800,theme:"primary","mask-close":!1,"header-position":"left",title:"新增实例"},on:{confirm:e.confirm},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",{staticClass:"content-box"},[t("div",{staticClass:"table-box"},[t("bk-input",{attrs:{clearable:!0,"right-icon":"bk-icon icon-search",placeholder:"请输入名称进行实例搜索"},on:{enter:e.getList,clear:e.getList},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}}),e._v(" "),t("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading},expression:"{ isLoading: tableLoading }"}],ref:"comTable",staticClass:"mt20",attrs:{data:e.tableData,columns:e.columns,pagination:e.pagination},on:{"select-all":e.selectAllTableData,select:e.selectTableData,"page-change":e.handlePageChange,"page-limit-change":e.limitChange}})],1),e._v(" "),t("div",{staticClass:"result-box"},[t("div",{staticClass:"title"},[e._v("结果预览")]),e._v(" "),t("div",{staticClass:"info"},[t("div",{staticClass:"info-left"},[t("span",[e._v("已选择")]),e._v(" "),t("span",{staticStyle:{color:"#659FFD"}},[e._v(e._s(e.selectList.length))]),e._v(" "),t("span",[e._v("项实例")])]),e._v(" "),t("div",{staticClass:"info-right",on:{click:e.clearSelect}},[e._v("清空")])]),e._v(" "),t("div",{staticClass:"list"},e._l(e.selectList,(function(n,i){return t("div",{directives:[{name:"bk-overflow-tips",rawName:"v-bk-overflow-tips"}],key:n.id,class:["list-item",i!==e.selectList.length-1&&"list-item-border-bottom","hide-text"]},[t("span",{staticClass:"value"},[e._v(e._s(n[e.instanceShowField]))]),e._v(" "),t("i",{staticClass:"cw-icon weops-close",on:{click:function(t){return e.removeSelect(n,i)}}})])})),0)])])])}),[],!1,null,"5a920398",null).exports,T=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),$=function(e,t,n,i){var a,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,n,r):a(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},M=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},S=function(e,t){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(r=0)),r;)try{if(n=1,i&&(a=2&s[0]?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(a=r.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){r.label=s[1];break}if(6===s[0]&&r.label<a[1]){r.label=a[1],a=s;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(s);break}a[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],i=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loading=!1,t.visible=!1,t.type="add",t.instanceTypeList=[],t.permissionTypeList=[],t.tableData=[],t.columns=[],t.formData={instanceType:"",permissionType:[],instanceScope:[],modelId:""},t.rules={instanceType:[{required:!0,message:"必填项",trigger:"blur"}],permissionType:[{required:!0,message:"必填项",trigger:"blur"}],modelId:[{required:!0,message:"必填项",trigger:"blur"}]},t.instanceTypeLoading=!1,t.instanceColumns=[],t.instanceShowField="",t.selectTableList=[],t.detail="",t.instancePermissionDetail={},t.modelLoading=!1,t.modelList=[],t.pageLoading=!1,t.columnsLoading=!1,t.isFirstEnter=!0,t}return T(t,e),Object.defineProperty(t.prototype,"isAdd",{get:function(){return"add"===this.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isShowModel",{get:function(){return["监控策略","监控采集"].includes(this.formData.instanceType)},enumerable:!1,configurable:!0}),t.prototype.changeCheckbox=function(e){"manage"===e.id&&this.setPermissionType("view",!0),"view"!==e.id||e.value||this.setPermissionType("manage",e.value),this.formData.permissionType=this.permissionTypeList.filter((function(e){return e.value})).map((function(e){return e.id}))},t.prototype.setPermissionType=function(e,t){var n=this;this.permissionTypeList.forEach((function(i){i.id===e&&n.$set(i,"value",t)}))},t.prototype.show=function(e,t){return M(this,void 0,void 0,(function(){var n,i,a,o,r,s,c,l,u=this;return S(this,(function(p){switch(p.label){case 0:Object.assign(this.$data,this.$options.data.call(this)),this.visible=!0,this.type=e,this.initData(),this.detail=t||{},p.label=1;case 1:return p.trys.push([1,8,9,10]),this.isAdd?[3,5]:(this.pageLoading=!0,[4,Promise.all([this.getInstancePermissionDetail(this.detail.id),this.getInstanceTypes()])]);case 2:return p.sent(),this.formData.instanceType=this.instancePermissionDetail.instance_type,[4,this.$nextTick()];case 3:for(a in p.sent(),n=function(e){i.instancePermissionDetail.permissions[e]&&"bk_obj_id"!==e&&i.permissionTypeList.forEach((function(t){t.id===e&&u.$set(t,"value",!0)}))},i=this,this.instancePermissionDetail.permissions)n(a);return this.formData.permissionType=this.permissionTypeList.filter((function(e){return e.value})).map((function(e){return e.id})),this.formData.modelId=this.instancePermissionDetail.permissions.bk_obj_id,[4,this.$api.RoleManageMain.getInstances({page:1,page_size:9999,search:"",instance_type:this.formData.instanceType,bk_obj_id:this.formData.modelId})];case 4:return o=p.sent(),r=o.result,s=o.data,r&&(c=s.items.reduce((function(e,t){return e[t.id]=t,e}),{}),this.instancePermissionDetail.instances.forEach((function(e){var t=c[e];t&&u.tableData.push(t)}))),this.pageLoading=!1,[3,7];case 5:return[4,this.getInstanceTypes()];case 6:p.sent(),p.label=7;case 7:return[3,10];case 8:return l=p.sent(),console.error("An error occurred:",l),[3,10];case 9:return this.pageLoading=!1,[7];case 10:return[2]}}))}))},t.prototype.changeModel=function(){var e=this;if(this.instanceShowField="",this.isFirstEnter||(this.tableData=[]),this.instanceColumns=[],!this.formData.modelId)return!1;this.columnsLoading=!0,this.$api.RoleManageMain.getMonitorAttrs({bk_obj_id:this.formData.modelId,instance_type:this.formData.instanceType}).then((function(t){var n=t.result,i=t.data;if(!n)return!1;e.instanceShowField=i.show,e.handleColumns(i.fields),e.isFirstEnter=!1})).finally((function(){e.columnsLoading=!1}))},t.prototype.initData=function(){this.formData={instanceType:"",permissionType:[],instanceScope:[],modelId:""},this.tableData=[]},t.prototype.getInstancePermissionDetail=function(e){var t=this;return this.$api.RoleManageMain.getInstPermissionsDetail({id:e}).then((function(e){var n=e.result,i=e.data;if(!n)return!1;t.instancePermissionDetail=i}))},t.prototype.select=function(e){this.selectTableList=e},t.prototype.batchRemoveList=function(){var e=this;this.selectTableList.forEach((function(t){var n=e.tableData.findIndex((function(e){return e.id===t.id}));e.tableData.splice(n,1)})),this.selectTableList=[]},t.prototype.removeSelectList=function(e){this.tableData.splice(e,1)},t.prototype.getSelectList=function(e){this.tableData=e},t.prototype.changeInstanceType=function(e){this.permissionTypeList=[],this.tableData=[],this.instanceColumns=[],this.instanceShowField="",this.formData.modelId="";var t=this.instanceTypeList.find((function(t){return t.instance_type===e}));for(var n in t.permissions)this.permissionTypeList.push({id:n,label:t.permissions[n],value:!1});if(this.isShowModel)return this.getModelList(e),!1;this.handleColumns(t.fields),this.instanceShowField=t.show},t.prototype.handleColumns=function(e){var t=this;for(var n in this.instanceColumns=[{type:"selection",width:"50px"}],e)"id"!==n&&this.instanceColumns.push({label:e[n],key:n,align:"left",minWidth:"120px"});this.$nextTick((function(){var e=t.$refs.comTable;t.columns=t.instanceColumns.concat([{label:"操作",key:"operation",width:"160px",prop:"operation",scopedSlots:"operation"}]),e.updateColumns(t.columns)}))},t.prototype.getModelList=function(e){var t=this;this.modelLoading=!0,this.$api.MonitorCollectMain["监控策略"===e?"getStrategyTree":"getCollectTree"]().then((function(n){var i=n.result,a=n.data;if(!i)return!1;var o="监控策略"===e?[]:["Cloud","bk_device","k8s"];t.modelList=t.extractLastItems(a,o),"监控策略"===e&&t.modelList.forEach((function(e){e.disabled="bk_web_measurement"===e.bk_obj_id})),t.isAdd||(t.formData.modelId=t.instancePermissionDetail.permissions.bk_obj_id||"")})).finally((function(){t.modelLoading=!1}))},t.prototype.extractLastItems=function(e,t){var n=this;void 0===t&&(t=[]);var i=[];return e.forEach((function(e){if(e.children&&e.children.length>0)t.includes(e.name)?i.push({bk_obj_id:e.name,bk_obj_name:e.cn_name}):i.push.apply(i,n.extractLastItems(e.children,t));else{var a={bk_obj_id:e.bk_obj_id||e.name,bk_obj_name:e.bk_obj_name||e.cn_name};i.push(a)}})),i},t.prototype.getInstanceTypes=function(){var e=this;return this.instanceTypeLoading=!0,this.$api.RoleManageMain.getInstanceTypes().then((function(t){var n=t.result,i=t.data;if(!n)return!1;e.instanceTypeList=i})).finally((function(){e.instanceTypeLoading=!1}))},t.prototype.addInstance=function(){return this.formData.instanceType?this.isShowModel&&!this.formData.modelId?(this.$warn("请先选择模型"),!1):void this.$refs.addInstance.show(this.tableData):(this.$warn("请先选择实例类型"),!1)},t.prototype.confirm=function(){var e=this;this.$refs.validateForm.validate().then((function(t){if(!e.tableData.length)return e.$warn("请选择实例"),!1;var n=e.isAdd?"createInstPermissions":"editInstPermissions",i={instance_type:e.formData.instanceType,permissions:{use:!!e.formData.permissionType.find((function(e){return"use"===e})),view:!!e.formData.permissionType.find((function(e){return"view"===e})),manage:!!e.formData.permissionType.find((function(e){return"manage"===e})),bk_obj_id:e.formData.modelId},instances:e.tableData.map((function(e){return e.id})),role:e.role.id};e.loading=!0,e.$api.RoleManageMain[n](e.isAdd?i:{id:e.detail.id,body:i}).then((function(t){var n=t.result,i=t.message;if(!n)return e.$error(i),!1;e.$success("".concat(e.isAdd?"新增":"修改","实例权限成功")),e.cancel(),e.$emit("refresh-list")})).finally((function(){e.loading=!1}))}))},t.prototype.cancel=function(){this.visible=!1},$([Object(o.c)({type:Object,default:function(){return{}}})],t.prototype,"role",void 0),t=$([Object(o.a)({components:{ComTable:a.a,AddInstance:j}})],t)}(o.d),R=A,E=Object(p.a)(R,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("bk-sideslider",{attrs:{width:750,"is-show":e.visible,"mask-close":!1},on:{"update:isShow":function(t){e.visible=t},"update:is-show":function(t){e.visible=t},hidden:function(t){e.visible=!1}}},[t("div",{attrs:{slot:"header"},slot:"header"},[e._v("权限管理-"+e._s((e.isAdd?"新增":"编辑")+"实例权限"))]),e._v(" "),t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.pageLoading},expression:"{ isLoading: pageLoading }"}],staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[t("div",{staticClass:"form-box"},[t("bk-form",{ref:"validateForm",attrs:{"label-width":90,model:e.formData,rules:e.rules}},[t("bk-form-item",{attrs:{label:"实例类型",required:!0,property:"instanceType","error-display-type":"normal"}},[t("bk-select",{staticStyle:{width:"300px"},attrs:{loading:e.instanceTypeLoading,clearable:!1},on:{change:e.changeInstanceType},model:{value:e.formData.instanceType,callback:function(t){e.$set(e.formData,"instanceType",t)},expression:"formData.instanceType"}},e._l(e.instanceTypeList,(function(e){return t("bk-option",{key:e.instance_type,attrs:{id:e.instance_type,name:e.instance_type}})})),1)],1),e._v(" "),e.isShowModel?t("bk-form-item",{attrs:{label:"模型",required:!0,property:"modelId","error-display-type":"normal"}},[t("bk-select",{staticStyle:{width:"300px"},attrs:{searchable:"",loading:e.modelLoading},on:{change:e.changeModel},model:{value:e.formData.modelId,callback:function(t){e.$set(e.formData,"modelId",t)},expression:"formData.modelId"}},e._l(e.modelList,(function(e){return t("bk-option",{key:e.bk_obj_id,attrs:{id:e.bk_obj_id,disabled:e.disabled,name:e.bk_obj_name}})})),1)],1):e._e(),e._v(" "),e.permissionTypeList.length?t("bk-form-item",{attrs:{label:"权限类型",required:!0,property:"permissionType","error-display-type":"normal"}},e._l(e.permissionTypeList,(function(n){return t("bk-checkbox",{key:n.id,staticClass:"mr20",attrs:{"true-value":!0,"false-value":!1},on:{change:function(t){return e.changeCheckbox(n)}},model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"item.value"}},[e._v("\n                            "+e._s(n.label)+"\n                        ")])})),1):e._e(),e._v(" "),t("bk-form-item",{attrs:{label:"实例范围",required:!0,"error-display-type":"normal"}},[t("bk-button",{staticClass:"mr20",attrs:{disabled:e.columnsLoading,theme:"primary"},on:{click:e.addInstance}},[e._v("\n                            新增实例\n                        ")]),e._v(" "),t("bk-button",{attrs:{disabled:!e.selectTableList.length,theme:"default"},on:{click:e.batchRemoveList}},[e._v("\n                            批量移除\n                        ")])],1)],1),e._v(" "),t("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.columnsLoading},expression:"{ isLoading: columnsLoading }"}],ref:"comTable",staticClass:"mt20",attrs:{data:e.tableData,columns:e.columns},on:{"select-all":e.select,select:e.select},scopedSlots:e._u([{key:"operation",fn:function({index:n}){return[t("bk-button",{attrs:{text:!0,title:"primary"},on:{click:function(t){return e.removeSelectList(n)}}},[e._v("\n                            移除\n                        ")])]}}])})],1),e._v(" "),t("div",{staticClass:"foot-box"},[t("bk-button",{attrs:{theme:"default",type:"submit"},on:{click:e.cancel}},[e._v("\n                    取消\n                ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{loading:e.loading,theme:"primary"},on:{click:e.confirm}},[e._v("\n                    确认\n                ")])],1)])]),e._v(" "),t("add-instance",{ref:"addInstance",attrs:{"instance-show-field":e.instanceShowField,"instance-type":e.formData.instanceType,"model-id":e.formData.modelId,"instance-columns":e.instanceColumns},on:{"change-list":e.getSelectList}})],1)}),[],!1,null,"28114496",null).exports,N=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),z=function(e,t,n,i){var a,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,n,r):a(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},F=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},V=function(e,t){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(r=0)),r;)try{if(n=1,i&&(a=2&s[0]?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(a=r.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){r.label=s[1];break}if(6===s[0]&&r.label<a[1]){r.label=a[1],a=s;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(s);break}a[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],i=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tableLoading=!1,t.tableData=[],t.columns=[{label:"实例类型",key:"instance_type",align:"left",minWidth:"120px"},{label:"实例数量",key:"count",align:"left",minWidth:"120px"},{label:"权限类型",key:"permissions_text",align:"left",minWidth:"120px"},{label:"操作",key:"operation",width:"160px",prop:"operation",scopedSlots:"operation"}],t.pagination={current:1,count:20,limit:20},t}return N(t,e),t.prototype.mounted=function(){this.getList()},t.prototype.operateInstancePermission=function(e,t){this.$refs.operateInstancePermission.show(e,t)},t.prototype.deleteInstancePermission=function(e){var t=this;this.$bkInfo({title:"确认要删除该实例权限？",confirmLoading:!0,confirmFn:function(){return F(t,void 0,void 0,(function(){return V(this,(function(t){switch(t.label){case 0:return[4,this.confirmDelete(e)];case 1:return t.sent(),[2]}}))}))}})},t.prototype.confirmDelete=function(e){return F(this,void 0,void 0,(function(){var t;return V(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.$api.RoleManageMain.deleteInstPermissions({id:e.id})];case 1:return(t=n.sent()).result?(this.$success("删除成功!"),this.pagination.current>1&&1===this.tableData.length&&this.pagination.current--,this.getList()):this.$error(t.message),[2,!0];case 2:return n.sent(),[2,!1];case 3:return[2]}}))}))},t.prototype.getList=function(){var e=this;this.tableLoading=!0,this.$api.RoleManageMain.getInstPermissions({role:this.role.id,page:this.pagination.current,page_size:this.pagination.limit}).then((function(t){var n=t.result,i=t.data;if(!n)return!1;e.tableData=i.items,e.pagination.count=i.count})).finally((function(){e.tableLoading=!1}))},t.prototype.handlePageChange=function(e){this.pagination.current=e,this.getList()},t.prototype.limitChange=function(e){this.pagination.current=1,this.pagination.limit=e,this.getList()},z([Object(o.c)({type:Object,default:function(){return{}}})],t.prototype,"role",void 0),t=z([Object(o.a)({components:{ComTable:a.a,OperateInstancePermission:E}})],t)}(o.d),q=W,B=Object(p.a)(q,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"instance-permission"},[t("bk-button",{staticClass:"mt20",attrs:{theme:"primary"},on:{click:function(t){return e.operateInstancePermission("add")}}},[e._v("\n        新增权限\n    ")]),e._v(" "),t("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading},expression:"{ isLoading: tableLoading }"}],ref:"comTable",staticClass:"mt20",attrs:{data:e.tableData,columns:e.columns,pagination:e.pagination},on:{"page-change":e.handlePageChange,"page-limit-change":e.limitChange},scopedSlots:e._u([{key:"operation",fn:function({row:n}){return[t("bk-button",{staticClass:"mr10",attrs:{text:!0,title:"primary"},on:{click:function(t){return e.operateInstancePermission("edit",n)}}},[e._v("\n                编辑\n            ")]),e._v(" "),t("bk-button",{attrs:{text:!0,title:"primary"},on:{click:function(t){return e.deleteInstancePermission(n)}}},[e._v("\n                删除\n            ")])]}}])}),e._v(" "),t("operate-instance-permission",{ref:"operateInstancePermission",attrs:{role:e.role},on:{"refresh-list":e.getList}})],1)}),[],!1,null,"6a78618f",null).exports,H=n("8lkm"),J=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),G=function(e,t,n,i){var a,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,n,r):a(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},K=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isShow=!1,t.panels=[{name:"operationPermission",label:"操作权限"},{name:"instancePermission",label:"实例权限"}],t.active="operationPermission",t.role={},t.menuLoading=!1,t.appLoading=!1,t.latestMenu=[],t.latestOperate=[],t.latestApp=[],t.loading=!1,t}return J(t,e),Object.defineProperty(t.prototype,"disableBtn",{get:function(){return"operationPermission"===this.active?this.menuLoading:this.appLoading},enumerable:!1,configurable:!0}),t.prototype.getLatestMenu=function(e){this.latestMenu=e.checkAuthIds,this.latestOperate=e.operateAuthIds},t.prototype.getLatestApp=function(e){this.latestApp=e},t.prototype.getMenuLoading=function(e){this.menuLoading=e},t.prototype.getAppLoading=function(e,t){this.appLoading=e,"hide"===t&&(this.isShow=!1)},t.prototype.show=function(e){this.isShow=!0,this.role=e,this.active="operationPermission"},t.prototype.toTabMenu=function(e){this.active=e.name},t.prototype.confirm=function(){var e=this;this.$refs.menuPermission.getLatestMenu(),this.$refs.appPermission.getLatestApp(),this.loading=!0,this.$api.RoleManageMain.setRoleMenu({id:this.role.id,menu_ids:this.latestMenu||[],operate_ids:this.latestOperate||[],app_ids:this.latestApp||[]}).then((function(t){var n=t.result,i=t.message;if(!n)return e.$error(i),!1;e.$success("权限设置成功!"),e.isShow=!1})).finally((function(){e.loading=!1}))},t=G([Object(o.a)({name:"permission-settings",components:{AppPermission:y,OperationPermission:C,InstancePermission:B,menuTab:H.a}})],t)}(o.d),Q=K,U=Object(p.a)(Q,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("bk-sideslider",{attrs:{"is-show":e.isShow,"quick-close":!0,title:"权限管理",width:850},on:{"update:isShow":function(t){e.isShow=t},"update:is-show":function(t){e.isShow=t}}},[t("div",{staticClass:"content-box",attrs:{slot:"content"},slot:"content"},[t("menu-tab",{attrs:{panels:e.panels,"active-panel":e.active},on:{click:e.toTabMenu}}),e._v(" "),t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading,zIndex:10},expression:"{ isLoading: loading, zIndex: 10 }"}],staticClass:"main-box"},[t("operation-permission",{directives:[{name:"show",rawName:"v-show",value:"operationPermission"===e.active,expression:"active === 'operationPermission'"}],ref:"menuPermission",attrs:{role:e.role},on:{getMenuLoading:e.getMenuLoading,getLatestMenu:e.getLatestMenu}}),e._v(" "),t("app-permission",{directives:[{name:"show",rawName:"v-show",value:"appPermission"===e.active,expression:"active === 'appPermission'"}],ref:"appPermission",attrs:{role:e.role},on:{getAppLoading:e.getAppLoading,getLatestApp:e.getLatestApp}}),e._v(" "),t("instance-permission",{directives:[{name:"show",rawName:"v-show",value:"instancePermission"===e.active,expression:"active === 'instancePermission'"}],ref:"instancePermission",attrs:{role:e.role}})],1),e._v(" "),t("div",{staticClass:"footer-box"},["instancePermission"!==e.active?t("bk-button",{attrs:{disabled:e.disableBtn||e.loading,theme:"primary",title:"确定"},on:{click:e.confirm}},[e._v("\n                确定\n            ")]):e._e()],1)],1)])}),[],!1,null,"1ec2dbcd",null).exports,X=n("7Jkb"),Y=n("NjKV"),Z=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ee=function(e,t,n,i){var a,o=arguments.length,r=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(r=(o<3?a(r):o>3?a(t,n,r):a(t,n))||r);return o>3&&r&&Object.defineProperty(t,n,r),r},te=function(e,t,n,i){return new(n||(n=Promise))((function(a,o){function r(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}c((i=i.apply(e,t||[])).next())}))},ne=function(e,t){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(r=0)),r;)try{if(n=1,i&&(a=2&s[0]?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(a=r.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){r.label=s[1];break}if(6===s[0]&&r.label<a[1]){r.label=a[1],a=s;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(s);break}a[2]&&r.ops.pop(),r.trys.pop();continue}s=t.call(e,r)}catch(e){s=[6,e],i=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},ie=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tableLoading=!1,t.dataList=[],t.columns=[{label:"角色名称",key:"role_name",align:"left",minWidth:"100px"},{label:"角色描述",key:"describe",align:"left",minWidth:"300px"},{label:"创建时间",key:"created_at",align:"left",minWidth:"120"},{label:"操作",key:"operation",align:"left",width:"230px",scopedSlots:"operation"}],t.pagination={current:1,count:1,limit:20},t.maxHeight="",t.search="",t}return Z(t,e),Object.defineProperty(t.prototype,"powerParams",{get:function(){return{id:this.$route.name,type:"operateAuth"}},enumerable:!1,configurable:!0}),t.prototype.created=function(){var e=this;this.getRoleList();this.maxHeight=window.innerHeight-276,window.onresize=function(){e.maxHeight=window.innerHeight-276}},t.prototype.handlerIconClick=function(){this.pagination.current=1,this.getRoleList()},t.prototype.personnelManage=function(e){this.$refs.authWhiteList.showSlider({user:e.users},e)},t.prototype.setPermission=function(e){if(!this.$BtnPermission(this.powerParams))return!1;this.$refs.permissionSettings.show(e)},t.prototype.operateRole=function(e,t){if(!this.$BtnPermission(this.powerParams))return!1;this.$refs.operateRole.show(e,t)},t.prototype.refreshList=function(){this.getRoleList()},t.prototype.deleteRole=function(e){var t=this;if(!this.$BtnPermission(this.powerParams))return!1;this.$bkInfo({title:"确认要删除该角色？",confirmLoading:!0,confirmFn:function(){return te(t,void 0,void 0,(function(){return ne(this,(function(t){switch(t.label){case 0:return[4,this.confirmDelete(e)];case 1:return t.sent(),[2]}}))}))}})},t.prototype.confirmDelete=function(e){return te(this,void 0,void 0,(function(){var t;return ne(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.$api.RoleManageMain.deleteRole({id:e.id})];case 1:return(t=n.sent()).result?(this.$success("删除成功!"),this.pagination.current>1&&1===this.dataList.length&&this.pagination.current--,this.getRoleList()):this.$error(t.message),[2,!0];case 2:return n.sent(),[2,!1];case 3:return[2]}}))}))},t.prototype.getRoleList=function(){var e=this,t={page:this.pagination.current,page_size:this.pagination.limit,search:this.search};this.tableLoading=!0,this.$api.RoleManageMain.getRoleList(t).then((function(t){if(!t.result)return!1;e.dataList=t.data.items,e.pagination.count=t.data.count})).finally((function(){e.tableLoading=!1}))},t.prototype.handlePageChange=function(e){this.pagination.current=e,this.getRoleList()},t.prototype.limitChange=function(e){this.pagination.current=1,this.pagination.limit=e,this.getRoleList()},t=ee([Object(o.a)({name:"role-manage",components:{ComTable:a.a,OperateRole:d,PermissionSettings:U,AuthWhiteList:X.a,PageExplanation:Y.a}})],t)}(o.d),ae=ie,oe=Object(p.a)(ae,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"role-manage"},[t("page-explanation",{attrs:{title:"角色管理",content:"您可以进行角色的新建和授权，权限的授权分为操作权限和实例权限，可从菜单操作和实例管理两个方面进行限制"}}),e._v(" "),t("div",{staticClass:"role-manage-wrapper"},[t("div",{staticClass:"operate-box"},[t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",title:"新增角色",icon:"plus"},on:{click:function(t){return e.operateRole("add")}}},[e._v("\n                新增角色\n            ")]),e._v(" "),t("bk-input",{staticStyle:{width:"300px"},attrs:{clearable:"",placeholder:"请输入搜索关键字","right-icon":"bk-icon icon-search"},on:{"right-icon-click":e.handlerIconClick,enter:e.handlerIconClick,clear:e.handlerIconClick},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),t("div",{staticClass:"table-box"},[t("com-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.tableLoading,zIndex:10},expression:"{ isLoading: tableLoading, zIndex: 10 }"}],ref:"comTable",attrs:{data:e.dataList,columns:e.columns,pagination:e.pagination,"max-height":e.maxHeight},on:{"page-change":e.handlePageChange,"page-limit-change":e.limitChange},scopedSlots:e._u([{key:"built_in",fn:function({row:t}){return[e._v("\n                    "+e._s(t.built_in?"是":"否")+"\n                ")]}},{key:"operation",fn:function({row:n}){return[t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(t){return e.personnelManage(n)}}},[e._v("\n                        人员管理\n                    ")]),e._v(" "),t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:n.is_super||"itsm_admin_group"===n.role_name},on:{click:function(t){return e.setPermission(n)}}},[e._v("\n                        设置权限\n                    ")]),e._v(" "),t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:n.built_in},on:{click:function(t){return e.operateRole("edit",n)}}},[e._v("\n                        编辑\n                    ")]),e._v(" "),t("bk-button",{directives:[{name:"permission",rawName:"v-permission",value:e.powerParams,expression:"powerParams"}],staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:n.built_in},on:{click:function(t){return e.deleteRole(n)}}},[e._v("\n                        删除\n                    ")])]}}])})],1),e._v(" "),t("operate-role",{ref:"operateRole",on:{refreshList:e.refreshList}}),e._v(" "),t("permission-settings",{ref:"permissionSettings"}),e._v(" "),t("auth-white-list",{ref:"authWhiteList",attrs:{"only-choose-user":!0,title:"人员管理"},on:{confirm:function(t){return e.getRoleList()}}})],1)],1)}),[],!1,null,"01291db1",null);t.default=oe.exports}}]);